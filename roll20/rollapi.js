// Farhome dice roller
// API Commands:
// !skill <attribute score> <proficiency> <expertise|optional>
// !roll <s> <p> <n> <b> <t>

var FarhomeDice = FarhomeDice || (function () {
    'use strict';

    // !!REPLACE THESE!!
    // If the dice icons are not showing up in your game you may need to rehost the images
    // in the icons folder and replace the urls here with the ones you hosted.
    var imgF = "https://www.farhomerpg.com/diceroller/images/fail.png",
        imgF2 = "https://www.farhomerpg.com/diceroller/images/failx2.png",
        imgCF = "https://www.farhomerpg.com/diceroller/images/crit-fail.png",
        imgB = "https://www.farhomerpg.com/diceroller/images/blank.png",
        imgS = "https://www.farhomerpg.com/diceroller/images/success.png",
        imgS2 = "https://www.farhomerpg.com/diceroller/images/successx2.png",
        imgCS = "https://www.farhomerpg.com/diceroller/images/crit-success.png",
        imgD = "https://www.farhomerpg.com/diceroller/images/defend.png",
        imgD2 = "https://www.farhomerpg.com/diceroller/images/defendx2.png",
        imgCD = "https://www.farhomerpg.com/diceroller/images/crit-defend.png",
        imgW = "https://www.farhomerpg.com/diceroller/images/wound.png"

    var allDice = [
        { roll: [imgB, imgS, imgS, imgS, imgS2, imgCS], val: [0, 1, 1, 1, 2, 2], crit: [0, 0, 0, 0, 0, 1], rrthresh: 0, clr: 'yellow' },
        { roll: [imgB, imgB, imgS, imgS, imgS, imgCS], val: [0, 0, 1, 1, 1, 2], crit: [0, 0, 0, 0, 0, 1], rrthresh: 0, clr: 'green' },
        { roll: [imgB, imgB, imgB, imgB, imgS, imgS], val: [0, 0, 0, 0, 1, 1], crit: [0, 0, 0, 0, 0, 0], rrthresh: 0, clr: 'white' },
        { roll: [imgCF, imgF, imgF, imgF, imgB, imgB], val: [-2, -1, -1, -1, 0, 0], crit: [-1, 0, 0, 0, 0, 0], rrthresh: -1, clr: 'red' },
        { roll: [imgCF, imgF2, imgF, imgF, imgF, imgB], val: [-2, -2, -1, -1, -1, 0], crit: [-1, 0, 0, 0, 0, 0], rrthresh: -1, clr: 'darkorchid' },
        { roll: [imgB, imgB, imgD, imgD2, imgCD, imgCD], val: [0, 0, 1, 2, 2, 2], crit: [0, 0, 0, 0, 1, 1], rrthresh: 0, clr: 'silver' },
        { roll: [imgB, imgB, imgD, imgD, imgD, imgCD], val: [0, 0, 1, 1, 1, 2], crit: [0, 0, 0, 0, 0, 1], rrthresh: 0, clr: 'goldenrod' },
        { roll: [imgW, imgW, imgW, imgW, imgW, imgW], val: [0, 0, 0, 0, 0, 0], crit: [0, 0, 0, 0, 0, 0], rrthresh: 0, clr: 'orangered' },
        { roll: [imgB, imgW, imgB, imgW, imgB, imgW], val: [0, 0, 0, 0, 0, 0], crit: [0, 0, 0, 0, 0, 0], rrthresh: 0, clr: 'orangered' },
        { roll: [imgS, imgS, imgS2, imgS2, imgCS, imgCS], val: [1, 1, 2, 2, 2, 2], crit: [0, 0, 0, 0, 1, 1], rrthresh: 0, clr: 'gold' },
        { roll: [imgF, imgB, imgD, imgD, imgD, imgD], val: [-1, 0, 0, 1, 1, 1], crit: [0, 0, 0, 0, 0, 0], rrthresh: 0, clr: 'brown' }
    ];
    var rollHistory = [];
    var character = undefined;
    var token = undefined;

    var templateBtn = "background-color: transparent; padding: 0px; display: inline-block; color: black; border: 0.5px solid";

    var exhaustMod = [0, -1, -1, -2, -2, -3];

    var imgMacro = function (src, color) {
        return "<img src='" + src + "' style='background-color:" + color + "; border: none;width: 32px; height: 32px;'>"
    };
    var rerollImgMacro = function (src, color) {
        return "<img src='" + src + "' style='background-color:" + color + "; border: none;width: 32px; height: 32px; opacity: 0.25;'>"
    };

    var spellInfo = {
        "cold-snap": { stat: "int", prof: "arcane", level: 0, ap: "5 AP", range: "2", duration: "instant", dmgType: "cold", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Sap heat from a creature you can see. Make a spellcasting roll against the creatures Stamina save. On success the creature takes a wound in cold damage and for every critical rolled the creature gains a level of slow until the end of their next turn.', 'Add an enhanced die for every level cast above cantrip.'] },
        "firebolt": { stat: "int", prof: "arcane", level: 0, ap: "6 AP", range: "8", duration: "instant", dmgType: "fire", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['Blast a creature you can see with a bolt of fire. Make a spellcasting roll against the creatures defense. On success the creature takes a wound in fire damage, adding a wound die on a critical.', 'Add a wound die for every level cast above cantrip.'] },
        "message": { stat: "int", prof: "arcane", level: 0, ap: "2 AP", range: "10+", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You attempt to send a telepathic message to a creature you're familiar with or that you can see. Make a spellcasting roll, adding a bad die for every 10 tiles of distance between you and the recipient. On success the recipient receives the message. You know whether the spell is successful or not.", 'Add an enhanced die for every level cast above cantrip.'] },
        "minor-image": { stat: "int", prof: "arcane", level: 0, ap: "4 AP", range: "10", duration: "5 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You create a small, soundless, illusory image no larger than 1 tile at a point within range you can see. The image is purely visual and objects pass through it as if it wasn't there. Any creature attempting to see through the illusion makes a perception check against your spellcasting roll. On success they see through the illusion. A creature that touches or passes through the illusion automatically succeeds this check.", 'Add an enhanced die for every level cast above cantrip.'] },
        "static-shock": { stat: "int", prof: "arcane", level: 0, ap: "6 AP", range: "3", duration: "instant", dmgType: "lightning", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Charge the air around a creature in range causing it to discharge through the creature. Make a spellcasting roll against the creatures Dexterity save. On success the creature takes a wound in lightning damage. If you roll a critical the spell bounces to an adjacent creature, making a new roll for the new creature. This cannot bounce to the same creature twice and must bounce if there is a creature adjacent to the target.', 'Add an enhanced die for every level cast above cantrip.'] },
        "thundering-blow": { stat: "int", prof: "arcane", level: 0, ap: "5 AP", range: "touch", duration: "instant", dmgType: "thunder", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Conjure a rolling thunder to blast a creature away. Make a spellcasting roll against the creatures Strength save. On success they take a wound die in thunder damage, are pushed back 1 tile, and staggered until the end of their next turn. For every critical rolled the creature is pushed an extra tile. If the creature is unable to move, either due to another creature or obstacle, add a wound die to the damage for every tile remaining.', 'Add an enhanced die for every level cast above cantrip.'] },
        "arcane-blasts": { stat: "int", prof: "arcane", level: 1, ap: "8 AP", range: "7", duration: "instant", dmgType: "force", dmg: [0, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['Fire a volley of 3 force blasts against creatures in range. The blasts travel around corners and obstacles, homing in on their target and ignoring cover. You may have all blasts target the same creature, or split the blasts between creatures. Make a spellcasting roll against the creatures Strength save. On success they take a wound die in force damage for every blast aimed at them, replacing a wound die with a wound for every critical rolled.', 'Fire another blast for every level cast above 1st.'] },
        "arcane-key": { stat: "int", prof: "arcane", level: 1, ap: "10 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Force a lock to open. Touching a lock you may make a lockpicking check using your spellcasting roll instead of your lockpicking skill. On success the lock is opened. This spell can open magical locks.', 'Add an enhanced die for every level cast above 1st.'] },
        "beam-of-fire": { stat: "int", prof: "arcane", level: 1, ap: "7 AP", range: "self", duration: "instant", dmgType: "fire", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['A blast of fire erupts from your hands hitting all creatures in a 4 tile line. Make a spellcasting roll against the creatures defense. On success the target takes a wound in fire damage, adding a wound on a critical.', 'The beam reaches 2 tiles further and deals an extra wound die for every level cast above 1st.'] },
        "call-lightning": { stat: "int", prof: "arcane", level: 1, ap: "7 (5) AP", range: "10", duration: "instant", dmgType: "lightning", dmg: [1, 2], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Call a bolt of lightning to strike a nearby creature you can see. Make a spellcasting roll against the creatures Dexterity save. On success they take 1 wound and 2 wound dice in lightning damage, becoming paralyzed until the end of their next turn on a critical. If cast in rainy conditions this spell only costs 5 AP.', 'Add an enhanced die for every level cast above 1st.'] },
        "chilling-ray": { stat: "int", prof: "arcane", level: 1, ap: "6 AP", range: "5", duration: "instant", dmgType: "cold", dmg: [0, 1], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Fire a frigid beam at 3 creatures in range you can see. Make a spellcasting roll against the creatures Stamina save. On success, the creature takes 1 wound die in cold damage and gains Slow 1, or Slow 2 on a critical.', 'Add an enhanced die for every level cast above 1st.'] },
        "detect-magic": { stat: "int", prof: "arcane", level: 1, ap: "6 AP", range: "10", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Attempt to read the flow of magic in a 10x10 area centered on a point in range. Making a spellcasting roll against 2 bad dice. On success you can see a faint outline over any magical effect in the area. For each critical you are able to determine the school of a given magic effect and a rough idea of the magic's purpose. For example you may learn a magical effect is a trap, but not how the trap is triggered or what the trap does.", 'Add an enhanced die for every level cast above 1st.'] },
        "identify": { stat: "int", prof: "arcane", level: 1, ap: "1 minute", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to learn the secrets of a magical item or trinket. Make a lore check using your spellcasting roll for the check. On success you learn the properties of the item.', 'Add an enhanced die for every level cast above 1st'] },
        "magic-sight": { stat: "int", prof: "arcane", level: 1, ap: "10 AP", range: "self", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Create a floating eye, visible only to those who can see the ethereal plane or have cast the spell _Detect Magic_ on it. You can see, but not hear, everything the eye can see in addition to your normal senses. On your turn you can command the eye to move up to 5 tiles as a free action. If the eye moves more than 10 tiles away from you, you must make a spellcasting roll against 2 bad dice, repeating this roll every minute. On failure the spell ends. The eye cannot move through solid objects, but can fit through a 1 inch hole.', 'If the eye is able to fully spot a creature behind cover, they gain 1 less bonus die from cover against your attacks.', 'Add an enhanced die for every level cast above 1st.'] },
        "poison-trap": { stat: "int", prof: "arcane", level: 1, ap: "7 AP", range: "5", duration: "1 minute", dmgType: "poison", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Summon bubbling acid on 3 tiles at points in range you can see. When a creature starts their turn or enters a tile for the first time on a round you make a spellcasting roll against their Stamina save. On success they take 1 wound in poison damage and on a critical gain poison 1 until the end of their next turn. These tiles count as difficult terrain, and last for 1 minute.', 'Add a tile for every level cast above 1st.'] },
        "ray-of-sickness": { stat: "int", prof: "arcane", level: 1, ap: "5 AP", range: "7", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A sickening beam blasts a creature in range you can see. Make a spellcasting roll against the creatures Stamina save. On success the target gains poison 1 for the next 10 minutes, or poison 2 on a critical.', 'You may target an additional creature for every level cast above 1st.'] },
        "sword-burst": { stat: "int", prof: "arcane", level: 1, ap: "3 AP", range: "self", duration: "1 minute.", dmgType: "force", dmg: [0, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['Magically enchant your weapon to fire a burst of energy with your next attack. You gain _Reach 1_ for the duration of the spell. On your next attack the target creature makes a Strength save instead of rolling defense. On hit, all physical damage dealt by the attack is converted to force damage and you deal an extra wound die of force damage with the attack. After you make the attack the spell ends.', 'Your reach increases by 1 and you add a wound die to the damage for every level cast above 1st.'] },
        "thunderclap": { stat: "int", prof: "arcane", level: 1, ap: "5 AP", range: "self", duration: "instant", dmgType: "thunder", dmg: [1, 1], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A wave of thunder roars around you, hitting all creatures adjacent to you. Make a spellcasting roll against the creatures defense. On success the creatures take 1 wound and 1 wound die in thunder damage and are staggered. On a critical the creatures are pushed away 1 tile from you taking an extra wound in thunder damage if an object or creature blocks their movement.', 'Add an enhanced die for every level cast above 1st.'] },
        "barrier": { stat: "int", prof: "arcane", level: 2, ap: "2 AP", range: "self", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['As a reaction you quickly summon magical defenses, protecting you and all adjacent creatures from an incoming spell. Making a spellcasting roll, you and all adjacent creatures add 1 superior die to their saving throw, adding an extra superior die for every critical. Creatures in the barrier gain _Resistance 2_ to Force damage.', 'Increase the range of protection by 1 and add an enhanced die for every level cast above 2nd.'] },
        "blink": { stat: "int", prof: "arcane", level: 2, ap: "3 AP", range: "5/10", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Attempt to teleport yourself to a unoccupied point you can see in range. Make a spellcasting roll against 1 bad die, or 3 bad dice if you attempt to teleport more than 5 tiles. On success you teleport to that position, preventing any opportunity attacks or attacks that trigger on entering someone's zone of control.", 'Add an enhanced die for every level cast above 2nd.'] },
        "combust": { stat: "int", prof: "arcane", level: 2, ap: "7 AP", range: "10", duration: "1 minute", dmgType: "fire", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Cause 2 creatures you can see in range to burst into flames. Make a spellcasting roll against the creatures Dexterity save. On success they ignite in flames taking 1 wound in fire damage at the start of their turn. On their turn they may spend 5 AP rolling on the ground to extinguish the fire, leaving them prone. Taking cold damage or being doused in water extinguishes the fire.', 'You may target an additional creature for every level cast above 2nd.'] },
        "dispel-magic": { stat: "int", prof: "arcane", level: 2, ap: "5 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to dispel a single magical effect targeting a creature or area. Make a spellcasting roll against 1 enhanced die per level of spell you are trying to dispel. If the effect you are trying to dispel is being concentrated on by another creature make a spellcasting roll against the creatures spellcasting roll instead. On success the magical effect ends. If targeting an effect caused by an object, such as a magic item or animated armor, they regain their magical effects after 10 minutes.', 'Some magical effects may not come from a spell. In these cases the GM determines the challenge rating or if the spell fails.', 'You may target an additional effect for every level cast above 2nd.'] },
        "elemental-shell": { stat: "int", prof: "arcane", level: 2, ap: "5 AP", range: "self", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Create an energy barrier around yourself. Choose a damage type: fire, cold, lightning, thunder, poison. Make a spellcasting roll, on success you gain Resistance 1 to that damage type, increasing the resistance by 1 for every critical rolled.', 'Add an enhanced die for every level cast above 2nd.'] },
        "hailstorm": { stat: "int", prof: "arcane", level: 2, ap: "7 AP", range: "touch", duration: "instant", dmgType: "cold", dmg: [0, 2], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You conjure a flurry of ice shards in a 3x3 tilr area adjacent to you. Make a spellcasting roll against the creatures Stamina save. On success they take 2 wound dice in cold damage, gaining 1 level of Slow for the next minute on a critical.', 'add a wound die and increase the area by 1 for every level cast above 2nd.'] },
        "imprint": { stat: "int", prof: "arcane", level: 2, ap: "up to 5 minutes", range: "self", duration: "concentration, 5 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to record your senses into an object, allowing a creature to replay your recording by holding the object and speaking a command word. Make a spellcasting roll, adding a superior die if a gemstone worth at least 50sc is used to store the recording. You can record a memory from the past 24 hours or record what you are currently experiencing. Depending on your successes the quality of the recording will change:', '- **0-1**: There is no sound, and the visuals are too blurry to make out faces, but you can make out the environment you are in.', '- **2-3**: You can determine each creatures race, but not face. You get a good idea of the area (in a cellar/building, number of trees, important landmarks such as a rock or pillar). You can hear if people are talking, but cannot make out words.', '- **3-5**: You can make out a creatures race and identify them if you have seen them before. You can hear enough to make out individual words when spoken, although there are occasional gaps.', '- **6+**: The recording is exact, with the user seeing and hearing exactly as the caster saw.', 'The recording is permanent, unless a command word is spoken to end the spell or _Dispel Magic_ is cast on it. A creature under _Nondetection_ appears as a blurry patch and their voice is unrecognizable regardless of the quality of recording.', 'Add an enhanced die for every level cast above 2nd.'] },
        "magic-weapon": { stat: "int", prof: "arcane", level: 2, ap: "10 AP", range: "5", duration: "concentration, 1 hour.", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Temporarily enchant a weapon with magic. You may target up to 5 weapons, adding a terrible die to your spellcasting roll for each weapon. On success the weapons are considered +1 magic weapons. If you lose concentration before the hour is finished the weapons retain the magic for 1 minute before fading completely.', 'Add an enhanced die for every level cast above 2nd.'] },
        "resilient-shield": { stat: "int", prof: "arcane", level: 2, ap: "4 AP", range: "self", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['On your turn or as a reaction, you create a dampening shield around yourself. Make a spellcasting roll against 1 bad die, or 2 if cast as a reaction. On success you create a shield of force around youself. While the shield holds you gain Resistance 2 to all physical damage. The shield can take 3 hits before shattering, adding a hit for each critical rolled. While the spell is active you cannot take the move or sprint actions.', 'Add an enhanced die for every level cast above 2nd.', '### Third Level'] },
        "animate-guardian": { stat: "int", prof: "arcane", level: 3, ap: "10 AP", range: "touch", duration: "concentration, 1 hour", dmgType: "Bludgeoning", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to animate a simple object made of plant, wood, stone, or metal no more than 1 tile in size. If the object is part of a larger construction (a stone wall, a dirt mound, etc.) you add 1 terrible die to your roll as you try to force it free.', "Make a spellcasting roll adding 2 terrible dice, or 4 terrible dice if the material is made of metal. On success you create a golem out of the object. The golem has 3 wounds and gains Resistance 1 to a damage type of your choosing: physical, fire, cold, lightning, poison. On your turn it can take a move action to move 4 tiles and may make an attack as free actions. The golem's attack uses your spellcasting roll instead of a normal attack roll. The creature deals a wound and wound die of bludgeoning damage on hit, adding a wound die for every size increase. After the duration or if the caster is incapacitated the golem reverts to inanimate material. Golems made of metal have Resistance 1 to all damage types instead.", 'Add an enhanced die for every level cast above 3rd. At 5th level you may target a 2x2 area creating a golem with 5 wounds, and at 7th a 3x3 area creating a golem with 8 wounds and two attacks per turn.'] },
        "chain-lightning": { stat: "int", prof: "arcane", level: 3, ap: "7 AP", range: "5", duration: "instant", dmgType: "lightning", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Conjure a burst of lightning that bounces from creature to creature. Targeting a creature you can see within range, the lightning bounces from them to 2 other creatures each within 3 tiles of the previous creature. The lightning cannot bounce to the same creature twice and must bounce to a creature if able. Make a spellcasting roll against the creatures Dexterity. On success they take 1 wound in lightning damage, adding a wound die for every critical.', 'The number of bounces increases by 1 and you add an enhanced die for every level cast above 3rd.'] },
        "counter-spell": { stat: "int", prof: "arcane", level: 3, ap: "2 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Attempt to counter a creatures flow of magic, stopping a spell before it can be cast. As a reaction, make a spellcasting roll against the caster's spellcasting roll, adding a success to your roll for every point of mana spent above the target spell or adding a failure for every point of mana spent below the target spell. On success the target spell has no effect.", 'Multiple casters can attempt to counter the same spell. When multiple casters cast _Counter Spell_ you use the combined mana across all casts when determining your roll.'] },
        "far-sight": { stat: "int", prof: "arcane", level: 3, ap: "10 AP", range: "1 mile", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['See far into the distance, bending your sight around obstacles. Choose a location in range and make a spellcasting roll against 2 terrible die, or 3 if the location is unfamiliar to you. On success you can see the target location as long as it is not complete incased. For example you would be able to see the happenings in a town, but not inside buildings. You can see the location as if you were present there but cannot make out sounds. At any time you may change the target of your sight requiring a turn to reorient yourself.', 'Add an enhanced die for every level cast above 3rd.'] },
        "fireball": { stat: "int", prof: "arcane", level: 3, ap: "8 AP", range: "10", duration: "instant", dmgType: "fire", dmg: [2, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['Launch a ball of fire centered at a target point in range you can see. The fireball explodes on impact, hitting all creatures in a 5x5 tile area. Make a spellcasting roll against the creatures Dexterity save. On success they take 2 wounds in fire damage, adding a wound die on a critical. On failure the creatures take half damage, rounding down.', 'Add a wound die for every level cast above 3rd.'] },
        "flight": { stat: "int", prof: "arcane", level: 3, ap: "7 AP", range: "5", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Gain magical flight, allowing you to float through the air. Choosing up to 5 willing creatures, make a spellcasting roll adding a terrible die for each creature chosen. On success all creatures gain a flying speed equal to their movement speeds.', 'Add an enhanced die for every level cast above 3rd.'] },
        "ice-knives": { stat: "int", prof: "arcane", level: 3, ap: "8 AP", range: "touch", duration: "instant", dmgType: "cold", dmg: [2, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You conjure an barrage of icicles, hitting all adjacent creatures and blasting an area 3 tiles wide and 4 tiles long adjacent to you. Make a spellcasting roll against the creatures Stamina save. On success they take 2 wounds in cold damage, being staggered on a critical.', 'Add a wound die for every level cast above 3rd.'] },
        "phantasmal-blades": { stat: "int", prof: "arcane", level: 3, ap: "8 AP", range: "10", duration: "instant", dmgType: "force", dmg: [3, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 1, 0], txt: ['Summon a barrage of force blades at a creature in range you can see. Make a spellcasting roll against the creatures Strength save. On success they take 3 wounds in force damage.', 'Add a wound die and normal die for every level cast above 3rd.'] },
        "protective-sigil": { stat: "int", prof: "arcane", level: 3, ap: "1 minute", range: "touch", duration: "8 hours", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create an invisible sigil on a willing creature, infused with another spell of 3rd level or below. When the creature is targeted by a harmful spell or attack the sigil activates, casting the stored spell before the attack lands. The spell must have a target specified beforehand, such as the attacker or yourself. Spells that do not target a creature, such as _Counter Spell_ or _Conjure Elemental_ cannot be placed into the sigil. Spells that target multiple creatures can only target the attacker, and spells that target an area must be centered on the attacker or yourself. The spell must have a casting time of 10 AP or less to be stored in the sigil.', 'To create the sigil make a spellcasting roll against 2 terrible dice. On success the spell is placed inside the sigil. Regardless of the outcome you pay the mana cost for both _Protective Sigil_ and the spell you want to store. The sigil can be dismissed by the caster or removed with _Dispel Magic_.', 'You may choose a spell to store that is one level higher for every level cast above 3rd.'] },
        "telepathic-bond": { stat: "int", prof: "arcane", level: 3, ap: "1 minute", range: "5", duration: "1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You form a telepathic connection with up to 5 willing creatures. Make a spellcasting roll, adding a bad die for every creature. On success all creatures may communicate telepathically with each other over any distance as long as they remain on the same plane. Creatures communicating this way understand each other even if they do not speak the same language.', 'Add an enhanced die for each level above 3rd.'] },
        "conjure-elemental": { stat: "int", prof: "arcane", level: 4, ap: "7 AP", range: "5", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure an elemental construct at a target location. You create an air, water, earth, or fire elemental, making a spellcasting roll against 2 terrible dice. On success you conjure an elemental with wounds equal to your spellcasting roll. The elemental is a medium creature, becoming a large creature if it has 5 wounds or more. The elemental uses your spellcasting roll for attacks and has _Resistance 3_ against its own element. The elemental takes its turn along side yours.', 'The elemental gains 1 max AP and you add a superior dice to your spellcasting roll for every level cast above 4th.'] },
        "fire-shell": { stat: "int", prof: "arcane", level: 4, ap: "7 AP", range: "self", duration: "concentration, 10 minutes", dmgType: "fire", dmg: [0, 2], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A shell of fire surrounds your body. For the duration you add 1 superior defense die to your defense rolls against ranged attacks, incinerating the projectile if the attack misses. When a creature adjacent to you makes a melee attack against you they make a Dexterity save against your spellcasting. On fail, they take 2 wound dice in fire damage, or 2 wounds on a critical. The damage from Fire Shell happens before the attack lands. If the creature is killed their attack has no effect.', 'Add an enhanced die for every level cast above 4th.'] },
        "ice-lance": { stat: "int", prof: "arcane", level: 4, ap: "8 AP", range: "touch", duration: "10 minutes", dmgType: "cold", dmg: [1, 2], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create 3 spears of solid ice. For the duration you may replace your melee attack with an Ice Lance, using your spellcasting roll for the attack roll. The lance is a two-handed weapon with _Reach 1_, and deals 1 wound and 2 wound dice in cold damage on hit. You may throw the lance at a point within 10 tiles causing it to explode, hitting all creatures in a 3x3 tile area. Make a spellcasting roll against the creatures defense. On hit the creatures take 1 wound and 2 wound dice in cold damage, giving a level of slow for every critical rolled. After the last lance is thrown the spell ends.', 'You may make one attack, melee or thrown, when casting this spell.', 'You create an additional lance for every level cast above 4th.'] },
        "lightning-bolt": { stat: "int", prof: "arcane", level: 4, ap: "8 AP", range: "self", duration: "instant", dmgType: "lightning", dmg: [1, 2], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Fire a bolt of lightning, hitting all creatures in a 25 tile line. The lightning ricochets off walls and solid objects. Make a spellcasting roll against the creatures Dexterity save. On success they take 1 wound and 2 wound dice in lightning damage, adding a wound die for every critical. On failure they take 1 wound in lightning damage instead.', 'Add an enhanced die for every level cast above 4th.'] },
        "nondetection": { stat: "int", prof: "arcane", level: 4, ap: "10 AP", range: "touch", duration: "concentration, 24 hours", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["For the duration of the spell a creature is undetectable by most forms of magic. Any spell of 4th level or below that grants magical sight does not see this creature, and locating spells of a similar level fail to find them. When spells of 5th level or higher, such as _Scrying_, attempt to detect the creature make a spellcasting roll against the spell's spellcasting roll. On success the creature remains undetected by that spell.", 'You may target an additional creature for every level cast above 4th.'] },
        "orb-of-acid": { stat: "int", prof: "arcane", level: 4, ap: "7 AP", range: "10", duration: "instant", dmgType: "poison", dmg: [0, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You conjure an orb of vitriolic acid, launching it at a target point in range you can see. On impact the orb explodes in a splash of acid, hitting all creatures in a 5 tile diamond. Make a spellcasting roll against the creatures Dexterity save. On success they take 3 wound dice in poison damage, and on a critical the acid breaks the armor worn by the creatures causing it to give one less defense die. Armor that gives no bonus is destroyed.', 'Regardless of the outcome acid covers the floor for the next minute. Any creature that starts their turn, or moves into it for the first time this round takes 1 wound in poison damage.', 'The area of the blast increases by 2 and the initial damage increases by 1 wound die for every level cast above 4th.'] },
        "passwall": { stat: "int", prof: "arcane", level: 4, ap: "1 minute", range: "touch", duration: "1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to mold a passage into a surface made of wood, stone, earth or another inorganic material, creating a doorway 2 tiles high and 2 tiles wide. The passage can be at most 4 tiles deep, if there is no area to exit on the other side the spell fails. Make a spellcasting roll, adding a terrible die for every 2 tiles of distance the passage creates. On success a passage forms in the wall.', 'Add an enhanced die and increase the maximum depth by 2 tiles for every level cast above 4th. At 7th level and above you may cast this on metal surfaces as well.'] },
        "starfall": { stat: "int", prof: "arcane", level: 4, ap: "9 AP", range: "25", duration: "1 minute", dmgType: "force", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Summon glowing star shards falling over a 9x9 tile area centered on a point in range. For the duration, any creature that starts their turn in the area makes a Strength save against your spellcasting roll. On failure they take 1 wound in force damage, adding a wound die on a critical.', 'Increase the area by 2 and duration by 1 turn for every level cast above 4th.'] },
        "illusory-space": { stat: "int", prof: "arcane", level: 5, ap: "10 AP", range: "20", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create an illusory landscape covering a 10x10x10 tile cube centered on a point in range you can see. The illusion can change the look, smell, sounds and temperature of the area and create sounds that can be heard up to 1 mile. All effects happen in the creatures mind and have no effect on the creature themselves. The illusion covers the landscape and you may extend the illusion up to 6 inches away from a surface with creatures that touch the illusion will believing they are interacting with it.', 'You may cast the illusion over a cliff or gap, for example creating a bridge over a a ravine. A creature that passes through your illusion and falls makes a Willpower save against your spellcasting roll. On failure they rationalize a reason for the outcome. Similarly you may create an illusion of something inside the space (eg: creating an illusion of a tower in a flat meadow), with the creature making a Willpower save when attempting to interact with it.', 'A creature attempting to perceive the illusion must make a perception check against your spellcasting, on success they see the illusion for what it is.', 'For every level cast above 5th you may extend the illusory space by another 10x10x10 cube.'] },
        "instant-fortification": { stat: "int", prof: "arcane", level: 5, ap: "1 turn", range: "5", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure fortifications of your design within a 5x5 tile area, extending 3 tiles high. The fortifications can be any shape and is made of shimmering bricks that sheds dim light over 2 tiles. The fortification can have multiple floors, stairs, ladders and doors, but cannot have complex structures such as a portcullis, draw bridge, or traps. It must contain at least one entrance, such as a door or gap 1 tile wide. Each tile square can be destroyed by taking a wound in damage, or having more than 2000 pounds of force or weight applied to it. The structure does not obey gravity and will not collapse if sections are destroyed. The fortifications have resistance to all damage except force damage.', 'This spell may be cast on existing fortifications, granting them the light and resistance effects, but not conjuring any new structures. If cast in this way the area effected is doubled on each side, covering a 10x10 tile area.', 'You may give the walls up to _Resistance 3_, with a minimum of 1. Make a spellcasting roll adding 2 terrible die per level of resistance, conjuring the fortifications on success.', 'For every level cast above 5th you create an additional 5x5 area which must share a side with the existing fortifications.'] },
        "open-warren": { stat: "int", prof: "arcane", level: 5, ap: "9 AP", range: "5", duration: "1 minute, concentration", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Force open a rift leading to a warren, a space between realms. You can hold the warren open for one minute, after which the gate closes. While inside the warren, every hour of travel is equivalent to 8 hours of travel in a realm. On entering and at the start of every hour you must make a spellcasting roll against 1 terrible die for every hour you've stayed in the warren. On failure you are ejected from the warren, being randomly placed in your realm within 20 miles of your position. While inside the warren you gain no benefits from taking short or long rests. You may end the spell at any time, opening a gate back to the realm this spell was cast in.", 'You do not start making spellcasting rolls to stay inside the warren for an hour for every level cast above 5th.'] },
        "poison-cloud": { stat: "int", prof: "arcane", level: 5, ap: "8 AP", range: "15", duration: "10 minutes", dmgType: "poison", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a 7x7 tile cloud of poison centered on a point in range you can see. The poison cloud bends around corners and permeates surfaces. While inside the poison cloud, any creature starting their turn there or entering for the first time this round makes a Stamina save against your spellcasting roll. On failure they gain poison 1 or have their poison condition increase in level and take 1 wound die in poison damage for each level of poison effecting them.', 'Strong winds can move or reduce the size of the poison cloud, with spells like _Gust_ reducing the size of the cloud by 1 every round.', 'The size of the cloud increases by 2 and you add an enhanced die for every level cast above 5th.'] },
        "wall-of-fire": { stat: "int", prof: "arcane", level: 5, ap: "8 AP", range: "15", duration: "instant", dmgType: "fire", dmg: [1, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['A great wall of fire, 10 tiles wide and 3 tiles high, erupts from the ground. Any creature that starts their turn in or adjacent to the wall or enters that area for the first time this round makes a defense roll against your spellcasting roll. On hit they take 1 wound and 3 wound dice in fire damage, igniting for 1 minute on a critical. On success they take half damage, rounded down. Any ranged weapon or spell attack made through the wall adds 2 bad dice to the attack, being incinerated by the wall if the attack misses.', 'Ignited creatures take 1 wound of fire damage at the start of their turn and may spend 5 AP to extinguish the fire, leaving them prone.', 'Add a wound die and increase the width by 2 tiles for every level cast above 5th.'] },
        "ward-area": { stat: "int", prof: "arcane", level: 5, ap: "10 minutes", range: "5", duration: "24 hours", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You crystalize the weave of magic around an area no larger than 100 tiles, securing it from outsiders. You may choose any or all of the following effects:', '- Sound cannot pass through the warded area, preventing sounds from entering or leaving.', '- The barrier becomes opaque preventing vision, looking like a dense cloud from either side.', '- Magical sensors, such as those created by _Magic Sight_, cannot pass through or be created inside the barrier.', '- locating or scrying magic targeting a creature inside the barrier automatically fails.', '- Teleportation by any means is prevented inside the barrier.', '- rifts to warrens or other realms are prevented from opening inside the barrier.', 'Make a spellcasting roll adding a bad die for every effect chosen. On success the barrier is created over the target area. Casting this every day for 30 days in the same location makes it permanent, only ending if dispelled.', 'The number of tiles effected increases by 100 for every level cast above 5th.'] },
        "anti-magic-field": { stat: "int", prof: "arcane", level: 6, ap: "9 AP", range: "10", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to stabilize an area against magic, creating a 5x5 tile anti-magic field centered on a point in range you can see. Make a spellcasting roll against 3 terrible dice, on success the field is created. For the duration, any time a spell or magical effect passes through or targets a point inside the area make a spellcasting roll. If the spell has less successes than your spellcasting roll the spell fails and has no effect. If a spell entering the field does not require a roll it must make one, either determined by the GM or by rolling 1 enhanced die for every spell level of the effect.', 'The area increases by 2 and you add a superior die to your spellcasting rolls for each level above 6th.'] },
        "conjuration": { stat: "int", prof: "arcane", level: 6, ap: "10 minutes", range: "touch", duration: "1 day", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure or reshape material into a form of your choosing. The material can be made of organic or inorganic material, such as leather, food, stone, or iron as long as you have seen the material before. Conjuring precious metals and materials, such as gemstones, gold, or diamonds will be brittle, crumbling after 10 minutes. The object cannot be magical in nature, such as a magic sword, potion, or scroll and must be simple, no more complex than a crossbow. For example, you may be able to conjure a door with hinges, a cart with wheels, or a chest but would not be able conjure a clock.', 'On casting the spell make a spellcasting roll against 3 bad dice, on success you conjure an object or objects up to 4 tiles in size, or 1/4th that size when conjuring items made of stone or metal.', 'The amount you can conjure doubles with each level above 6th; up to 8 tiles at 7th level, 16 tiles at 8th level, and 32 tiles at 9th level.'] },
        "earthquake": { stat: "int", prof: "arcane", level: 6, ap: "10 AP", range: "200", duration: "concentration, 10 minutes", dmgType: "Bludgeoning", dmg: [0, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cause the ground to quake and tremble, collapsing buildings and toppling trees in a 60x60 tile area centered on a point in range. Now and at the start of each of your turns make a spellcasting roll with each creature in the earthquake making a Strength save. On success they take 1 wound die in bludgeoning damage and are knocked prone. The earthquake causes all tiles in the area to become difficult terrain. Structures made of wood, leather, or similar material fall apart over the duration. Structures made of stone partially collapse after the full 10 minutes. Reinforced buildings such as keeps and castles may take superficial damage, with cracks or holes opening in its walls.', 'The range and area of the spell increases by 10 for each level above 6th.'] },
        "evocation": { stat: "int", prof: "arcane", level: 6, ap: "7 AP", range: "self", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You tap in to the latent mana in your surroundings, empowering your spells. Make a spellcasting roll against 3 terrible dice. On success you may reroll up to 5 dice between your spellcasting and spell damage rolls for the duration. Holding this connection is both mentally and physically exhausting. Should the spell end due to failing a concentration check you take 1 level of exhaustion, or 2 levels if you critically fail the concentration check.', 'Add an enhanced die for every level cast above 6th.'] },
        "forcewave": { stat: "int", prof: "arcane", level: 6, ap: "8 AP", range: "touch", duration: "instant", dmgType: "force", dmg: [0, 7], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 2, 0], txt: ['Harness your magic and unleash a destructive wave of force. A cone of force 5 tiles wide and 12 tiles long erupts from your hands. All creatures in the blast must make a Strength save against your spellcasting. On failure they take 7 wound dice in damage and are thrown back half the distance of the wave, on success they are pushed back 1 tile and take half damage, rounded down. Objects and structures made of wood or stone in the wave are destroyed, leaving difficult terrain.', 'The length of the wave increases by 3 and wound dice increases by 2 for each level above 6th.'] },
        "call-storm": { stat: "int", prof: "arcane", level: 7, ap: "10 AP", range: "20", duration: "concentration, 10 minutes", dmgType: "lightning, Thunder", dmg: [1, 4], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You summon storm clouds covering a 40x40 tile area centered on a point in range. For the duration the area is covered in light rainfall and strong winds. On casting this spell, and by spending 3 AP once per turn on following turns, you may activate one of the following effects:', '- **Gale winds:** The winds blow in a direction of your choosing, covering the area of the storm. All creatures in the storm make a Strength save against your spellcasting roll. On failure they are pushed back 2 tiles, being knocked prone on a critical. Until the start of your next turn moving into the wind takes 3 tiles of movement for every tile moved and ranged attacks made into the wind add 2 terrible dice to the roll.', '- **Downpour:** Torrential rainfall covers the area, extinguishing fires and greatly reducing visibility. A creature attempting to see through the rain and mists make a perception check against your spellcasting roll. On failure they cannot see further than 3 tiles.', '- **Thunderstrike:** Call town a thundering bolt at a creature inside the storm. Make a spellcasting roll against the creatures Dexterity save. On success they take 1 wound and 4 wound dice in lightning damage. All creatures within 2 tiles of the lightning blast make a Stamina save against your spellcasting roll instead. On failure they take 3 wound dice in thunder damage and are staggered.', 'Add an enhanced die for every level cast above 7th.'] },
        "mass-fireball": { stat: "int", prof: "arcane", level: 7, ap: "10 AP", range: "20", duration: "instant", dmgType: "fire", dmg: [2, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure 3 fireballs which explode in a 5x5 tile area centered on points in range you can see. All creatures hit by the fireballs make a Dexterity save against your spellcasting roll. On failure they take 2 wounds and 3 wound dice in fire damage damage, adding 2 wound dice on a critical. On success they take half damage, rounded down. The fireballs can overlap, a creature hit by 2 or more fireballs adds an extra wound to the damage for each fireball if they fail their save.', 'Add an extra fireball for every level cast above 7th.'] },
        "power-word:-fire": { stat: "int", prof: "arcane", level: 7, ap: "9 AP", range: "self", duration: "concentration, 5 minutes", dmgType: "fire", dmg: [1, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You speak a word of power as fire crawls across your body. Until the spell ends, you gain the following benefits:', '- You gain _Resistance 3_ to fire damage.', '- Any creature that moves adjacent to you for the first time this round, begins their turn there or makes a melee attack against you are burned by the fire and take 1 wound in fire damage.', '- You may spend 5 AP to unleash a cone of fire in front of you. The cone extends 5 tiles out and 3 tiles wide. Make a spellcasting roll against the creatures defense. On success they take 1 wound and 3 wound dice in fire damage.', '- You have expertise with spells that deal fire damage.', "Only a single Power Word can be active at once, casting another Power Word spell ends any other Power Word spells you've cast.", 'The damage from both sources increases by 1 wound die for every level cast above 7th.'] },
        "power-word:-ice": { stat: "int", prof: "arcane", level: 7, ap: "9 AP", range: "self", duration: "concentration, 5 minutes", dmgType: "cold", dmg: [0, 3], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You speak a word of power as ice rimes across your body. Until the spell ends, you gain the following benefits:', '- You gain _Resistance 3_ to cold damage.', '- Any creature that moves within 3 tiles of you for the first time this round or starts their turn there makes a Stamina save against your spellcasting. On failure they gain Slow 3 until the end of their turn.', '- You may spend 5 AP to freeze a creature within 5 tiles. Make a spellcasting roll against the creatures Stamina save. On success they take 3 wound dice in cold damage, being frozen in ice until the end of their next turn on a critical. While frozen they gain Resistance 2 to all but psychic damage and are stunned.', '- You have expertise with spells that deal cold damage.', "Only a single Power Word can be active at once, casting another Power Word spell ends any other Power Word spells you've cast.", 'The range of both effects increase by 1 and you add an enhanced die to your spellcasting rolls for every level cast above 7th.'] },
        "power-word:-lightning": { stat: "int", prof: "arcane", level: 7, ap: "9 AP", range: "self", duration: "concentration, 5 minutes", dmgType: "lightning", dmg: [1, 2], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You speak a word of power as lightning surges through your body. Until the spell ends, you gain the following benefits:', '- You gain _Resistance 3_ to lightning damage.', '- As a reaction or on your turn you may spend 2 AP to teleport to an unoccupied tile within 3 tiles of your position.', '- You may spend 5 AP to fire a lightning bolt against 3 creatures within 10 tiles of you. Make a spellcasting roll against the creatures Dexterity save. On success they take 1 wound and 2 wound dice in lightning damage, being paralyzed on a critical.', '- You have expertise with spells that deal lightning damage.', "Only a single Power Word can be active at once, casting another Power Word spell ends any other Power Word spells you've cast.", 'Add a superior die for every level cast above 7th.'] },
        "project-image": { stat: "int", prof: "arcane", level: 7, ap: "5 AP", range: "5", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You create a perfect image of a willing creature. Make a spellcasting roll against 2 terrible dice. On success an illusory copy of the creature appears in an empty tile adjacent to the creature. The illusion can interact with its surroundings and has temporary wounds equal to the number of successes in your spellcasting roll. Another creature can attempt to see through the illusion, making a perception check against your spellcasting roll. On success they know the illusion isn't real.", "The image looks identical to the creature it's based on, copying all clothes, armor, or weapons they are carrying. Any magical items are copied in appearance only. For example, a magical sword will look magical but not have any of the properties of the original sword. The image does not need food, water, or air and any non-damaging spell targeting it fails. The image rolls defense equal to the armor the image is wearing, minus any magic properties. The image does not gain any of the features or abilities of the creature its copying.", "For the duration of the spell you may choose to perceive through your senses or the image's senses. You may control the image as you would your own body; moving, interacting, and speaking as the image. When casting spells you may choose the image to be the source of the spell. You may make attacks using the image, using your spellcasting roll for the attack roll. The image cannot be healed or repaired and has _Vulnerability 3_ to force damage. The image is destroyed when entering a zone similar to that of _Anti-Magic Field_.", 'The duration increases to 8 hours at 8th level, 1 day at 9th level, and 7 days at 10th level.'] },
        "fiendfire": { stat: "int", prof: "arcane", level: 8, ap: "10 AP", range: "touch", duration: "instant", dmgType: "fire", dmg: [4, 4], lroll: [0, 0, 0, 0, 0, 0, 0, 2, 0, 0], txt: ['Summon the fires of hell, vaporizing everything in a narrow arc extending 9 tiles long and 3 tiles wide. Make a spellcasting roll against the creatures Dexterity save. On success they take 4 wounds and 4 wound dice in fire damage, adding a wound die for every critical. Any armor or weapon a creature is holding is destroyed if it is mundane, otherwise taking 1 level of damage. On success they take half damage, rounded down. A creature reduced to 0 wounds from this spell is immediately killed, turning to ash.', 'The fire burns through trees, bushes, or other plant matter leaving only ash. On impacting stone or earth the fire burns through it, leaving a hole a size of half the remaining distance. Metal and other similar materials melt, leaving a hole only a quarter of the remaining distance.', 'Add 2 wounds for each level cast above 8th.'] },
        "invulnerability": { stat: "int", prof: "arcane", level: 8, ap: "9 AP", range: "self", duration: "concentration, 1 minute", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cover yourself in a layer of force, warding yourself from harm. Make a spellcasting roll against 2 terrible dice. On success you gain _Resistance 1_ to all damage, increasing by 1 for each critical. While the ward holds you are immune to gaining poison, slow, and are uneffected by hazardous terrain.', 'The duration increases by 1 minute for each level cast above 8th.'] },
        "slow-time": { stat: "int", prof: "arcane", level: 8, ap: "10 AP", range: "5", duration: "concentration, 1 minute", dmg: [0, 0], lroll: [2, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Slow time, causing other creatures to freeze in place. You may choose up to 5 creatures, yourself included, to be excluded from this spell. Make a spellcasting roll against 2 terrible dice for every creature chosen. On success these creatures are able to freely move, while all other creatures experience time at a rate 100 times slower.', 'While time is slowed, all objects and terrain not held are frozen, unable to move. Interacting with another creature, such as attacking or casting a spell on them ends the effects of _Slow Time_ for the attacker, resolving the action once the spell ends.', 'At the start each of the casters turn they must make an exhaustion check against 2 terrible dice, gaining 1 level of exhaustion and ending the spell on failure.', 'Add 2 superior dice to the spellcasting roll for each level cast above 8th.'] },
        "stabilize-warren": { stat: "int", prof: "arcane", level: 8, ap: "10 minutes", range: "self", duration: "24 hours", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You stabilize a warren in the space between realms. Make a spellcasting roll against 4 terrible dice. On success you create a warren with a name of your choosing. Any creature that knows the name can travel to your warren with the _Open Warren_ spell.', 'The warren is accessible from the realm it was created on, but you may connect your warren to any realm you have been to before. You may choose the atmosphere, terrain, and weather inside the warren. While the warren is stabilized you automatically succeed spellcasting rolls made to travel= through it with the _Open Warren_ spell. After the duration the warren begins to decay and you lose any benefits for travelling this warren, fully decaying after 7 days.', 'Repeating this spell every day for a week will stabilize the Warren for 1 year.', 'When cast at 9th level the duration increases to 1 year, or 77 years after casting for a week. At 10th level the duration increases to 10 years, or 300 years after casting for a week.'] },
        "armageddon": { stat: "int", prof: "arcane", level: 9, ap: "1 turn", range: "90 tiles", duration: "1 turn", dmgType: "bludgeoning/fire", dmg: [8, 8], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 4, 0], txt: ['You attempt to bring forth the ruinous powers of Armageddon. Make a spellcasting roll, conjuring up to 3 meteors and adding 2 terrible dice to your roll for each meteor conjured. On success, choose a point in range for each meteor. At the start of your next turn the meteors impact the ground dealing 8 wounds in bludgeoning damage and 8 wound dice in fire damage to all creatures within 7 tiles of the impact. A creature in range of multiple meteors instead adds 2 wound dice to both damage types for each additional meteor. Buildings take full damage regardless of roll.', 'On failure the magic grounds itself through you, dealing 1 wound die in force damage for every failure in your spellcasting roll to you and every adjacent creature.', 'Add 3 superior dice when cast at 10th level.'] },


        "bleed": { stat: "wil", prof: "curse", level: 0, ap: "5 AP", range: "5", duration: "instant", dmgType: "death", dmg: [0, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Force open the wounds of a creature in range you can see. Make a spellcasting roll against the creatures Stamina save. On success they take 1 wound die in death damage, or 3 wound dice if they have already taken damage.', 'You may target an extra creature for every level cast above cantrip.'] },
        "eldritch-blast": { stat: "wil", prof: "curse", level: 0, ap: "5 AP", range: "7", duration: "instant", dmgType: "force", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Fire a burst of force at a creature in range you can see. Make a spellcasting roll against the creatures Strength save. On success they take 1 wound in force damage, adding a wound die on a critical.', 'Add an enhanced die for every level cast above cantrip.'] },
        "levitate": { stat: "wil", prof: "curse", level: 0, ap: "5 AP", range: "5", duration: "concentration, 5 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You magically levitate an object or creature weighing less than 40 lbs. If the creature is unwilling you make a spellcasting roll against their Strength save. On success you levitate the creature. Each turn you may move the creature 3 tiles up or down as a free action. This movement does not provoke opportunity attacks, and does not move them with enough force to damage them, but can force them prone (against the ceiling or floor).', 'The creature can attempt to move while levitated, moving a single tile horizontally when taking the move or sprint actions. On their turn a creature can attempt to free themselves by spending 5 AP to remake the save. If the creature moves more than 10 tiles away from you or their weight exceeds the spells limit the spell ends.', 'The maximum weight doubles for every level cast above cantrip.'] },
        "life-sense": { stat: "wil", prof: "curse", level: 0, ap: "5 AP", range: "10", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You sense the presence of living creatures in a 3x3 tile area centered on a point in range you can see. Make a spellcasting roll against the creatures Willpower save. On success a dim light surrounds the creatures bodies. For the duration the effected creatures gain no benefits from invisibility, stealth, hiding, or anything that would obscure them from view such as fog or foliage. The light can be seen through walls as long as you are within 5 tiles of the creature.', 'Add an enhanced die for every level cast above cantrip.'] },
        "trickery": { stat: "wil", prof: "curse", level: 0, ap: "4 (2) AP", range: "3", duration: "1 turn", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure up a display of illusory light to distract up to 5 creatures. Make a spellcasting roll, adding a terrible die for every creature you target. On success, the creatures add 1 bad die to their next attack or spell attack roll on their next turn.  You may cast this as a reaction for 2 AP, targeting a single creature and making a spellcasting roll against 2 terrible dice instead.', 'Add an enhanced die for every level cast above cast cantrip.'] },
        "witchcraft": { stat: "wil", prof: "curse", level: 0, ap: "3 AP", range: "5", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure up a display of witchcraft, displaying one of the following or similar effects:', '- give yourself a minor alteration to your look, for example changing your eye color, causing harmless steam or smoke to rise off your body, creating a dim halo around your head, etc.', '- Enhance your voice to reach 3 times as far', '- Cause harmless tremors and vibrations in the earth around you', '- Cause objects to harmlessly move', '- Change the brightness or color of fire, cause it to flicker, etc.', '- Create an instantaneous sound at a location.', 'A creature trying to see through these illusions must succeed on a perception check against your spellcasting roll.', 'Add an enhanced die for every level cast above cantrip.'] },
        "black-tendrils": { stat: "wil", prof: "curse", level: 1, ap: "7 AP", range: "5", duration: "10 minutes, requires a free hand", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Black tendrils erupt from your hand to bind a creature in range you can see. Make a spellcasting roll against the creatures Strength or Dexterity save. On success the creature is grappled, or restrained on a critical. The Tendrils require a free hand to grasp or else the spell ends. On each of your move and sprint actions you may move the grappled target 1 tile. On their turn the creature can spend 5 AP to make a Strength save against your spellcasting roll, freeing themselves on success. If the creature moves more than 5 tiles away from you the tendrils break and the spell ends.', 'Add an enhanced die for every level cast above 1st.'] },
        "charming-guise": { stat: "wil", prof: "curse", level: 1, ap: "7 AP", range: "10", duration: "1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You take on a charming persona, attempting to charm up to 5 creatures in range you can see. Make a spellcasting roll against the creatures Willpower save, adding 1 bad die for every creature past the first. If the creature is hostile to you it adds 1 superior die to their save. On success, the creatures are charmed by you for the duration. Charmed creatures treat you as a friendly acquaintance. The charm ends if they take any damage, or if you act in a harmful way towards them. After the spell ends the target knows it was charmed.', 'Add an enhanced die for every level cast above 1st.'] },
        "concealment": { stat: "wil", prof: "curse", level: 1, ap: "10 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["A dull sheen covers your body, hiding your presence. Targeting up to 5 creatures, make a spellcasting roll, adding 1 terrible die for every creature. On success they are concealed for the duration. Creatures that don't know you have trouble remembering you after you pass, not being able to recall details such as race, gender, or appearance. As long as you are undetected by a creature you gain 1 superior die for all stealth checks, adding a superior die for every critical rolled. Concealment ends after taking a hostile action against another creature.", 'Add an enhanced die for every level cast above 1st.'] },
        "crow-of-magthera": { stat: "wil", prof: "curse", level: 1, ap: "6 AP", range: "10", duration: "instant", dmgType: "death", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You summon a crow with obsidian feathers capable of cutting through flesh and metal. The crow flies through a creature in range you can see. Make a spellcasting roll against the creatures Dexterity save. On success they take 1 wound in death damage. On a critical the creatures armor provides 1 less defense die until repaired. Armor that no longer provides a defense bonus is destroyed.', 'Add a wound die for every level cast above 1st.'] },
        "curse-of-misfortune": { stat: "wil", prof: "curse", level: 1, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with misfortune. Make a spellcasting roll against the creatures Willpower save. On success the creature is cursed, adding a bad die to all saving throws, or a terrible die on a critical. This curse can be removed through _Cleanse_ as if it was a normal condition.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Fragility_, ends this curses effects.', 'You may target an additional creature for every level cast above 1st.'] },
        "firefly-swarm": { stat: "wil", prof: "curse", level: 1, ap: "7 AP", range: "7", duration: "1 minute", dmgType: "fire", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You summon a swarm of burning fireflies on a tile in range. The flies attach themselves to nearby creatures, igniting them. When a creature enters the swarm for the first time this round or begins their turn there they make a Stamina save against your spellcasting roll. On failure they take 1 wound of fire damage. Any invisible creatures hit by the fireflies lose their invisibility if it came from a spell, otherwise becoming visible for 1 minute. There are enough fireflies to burn 3 times, after which the swarm disappears.', 'The the fireflies cover 1 additional adjacent tile and the number of burns increase by 1 for every level cast above 1st.'] },
        "ghoulish-claws": { stat: "wil", prof: "curse", level: 1, ap: "6 AP", range: "Self", duration: "1 minute", dmgType: "poison", dmg: [0, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Your hands elongate, becoming deadly poisonous claws. While under the effects of this spell you may make an attack against a creature, using your spellcasting roll instead of your attack roll. On hit they take 3 wound dice in poison damage, paralyzing the target on a critical until the end of their next turn. You may make an attack when casting this spell.', 'The duration increases by 1 minute for every level cast above 1st.'] },
        "hex-bolt": { stat: "wil", prof: "curse", level: 1, ap: "7 AP", range: "5", duration: "1 minute", dmgType: "psychic", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Fire a bolt of psychic force, sticking to a creature in range you can see. Make a spellcasting roll against the creatures Willpower save, adding a bad die to your roll if the creature is not hexed. On success you deal 1 wound in psychic damage, adding a wound die if the creature is hexed. On a critical, the creature gains hex for 1 minute, or increases their level of hex up to a max of 3. For the next minute, once per turn you may spend 4 AP to make the same attack against the same creature, or move the hex bolt and attack a different creature within 2 tiles.', 'Add an enhanced die for every level cast above 1st.'] },
        "hex": { stat: "wil", prof: "curse", level: 1, ap: "5 AP", range: "5", duration: "10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['inflict a creature you can see with a hex. Make a spellcasting roll against the creatures Willpower save. On success they gain hex, or hex 2 on a critical.', 'Add an enhanced die for every level cast above 1st.'] },
        "occult-whispers": { stat: "wil", prof: "curse", level: 1, ap: "5 AP", range: "5", duration: "instant", dmgType: "psychic", dmg: [1, 1], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You whisper eldritch words into a creatures mind, causing it to panic. Make a spellcasting roll against the creatures Intelligence save. On success the creature takes a wound and a wound die of psychic damage, immediately fleeing on a critical. While fleeing the creature, if able, moves 1 tile per remaining AP up to their move speed, avoiding dangerous terrain if possible.', 'Regardless of success the creature is distracted by the whispers and cannot make opportunity attacks this turn.', 'Add an enhanced die for every level cast above 1st.'] },
        "quicken": { stat: "wil", prof: "curse", level: 1, ap: "7 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Enchant up to 5 creatures you can see, imbuing them with unnatural speed. Make a spellcasting roll adding a bad die for each creature targeted. On success, the creatures move and sprint actions cost 1 AP. In addition, for every critical the creatures move speed is increased by 1.', 'Add an enhanced die for every level cast above 1st.'] },
        "sleep": { stat: "wil", prof: "curse", level: 1, ap: "7 AP", range: "10", duration: "1 hour", dmg: [0, 0], lroll: [2, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to put a group of living creatures to sleep. Targeting a 6x6 tile area centered on a point in range, and make a spellcasting roll adding 2 superior dice. Starting with the creature with the lowest current wounds, subtract their remaining wounds from your successes. If you have 0 or more successes remaining they fall asleep for the duration. Continue this until there are no more creatures or you have no more successes remaining. Creatures that are hostile towards you or have magic resistance require 2 additional successes to put to sleep. Creatures that do not sleep are unaffected by this spell. The creatures wake up after the duration, if they take damage, or if another creature uses 5 AP to wake them.', 'Add 2 superior dice for each level above 1st.'] },
        "weal": { stat: "wil", prof: "curse", level: 1, ap: "1 minute", range: "5", duration: "4 hours", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Take a moment to study your surroundings, watching for signs of the near future for up to 5 creatures. This can come in many forms: the smell of the forest, the pattern of dust, the movement of clouds in the sky. Make a spellcasting roll adding a terrible die for each creature targeted. On success each creature adds a superior die to the next action of their choosing.', 'They can describe a condition to fufill or trigger before they take the action or simply choose the next time they take that action. Regardless they must add the superior die to the first action that meets the requirements. For example, if they choose "when I make a stealth check once I\'m inside the dungeon" any stealth checks rolled outside the dungeon do not add dice while the first check inside the dungeon will.', 'Add an enhanced die to the spellcasting roll for every level cast above 1st.'] },
        "betrayal": { stat: "wil", prof: "curse", level: 2, ap: "8 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to fill a creatures mind with rage, preventing it from seeing friend or foe. Make a spellcasting roll against the creatures Willpower save. On success the creature loses all remaining AP and makes an attack against a random creature within its attack range. For every critical rolled the target adds a normal die for all attack rolls for the duration. On each of this creatures turns they must spend it either attacking a random creature in range or moving towards the closest creature. Each time this creature takes damage they make a Willpower save against 2 bad dice, ending this effect on success.', 'Add an enhanced die for every level cast above 2nd.'] },
        "bewitched-arrow": { stat: "wil", prof: "curse", level: 2, ap: "1 minute", range: "touch", duration: "1 day", dmgType: "death", dmg: [1, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You conjure up to 5 deadly, blackthorn arrows. Make a spellcasting roll adding a bad die per arrow. The arrows count as magical ammunition and can be fired from a bow or thrown by hand. When thrown it has a range of 10 and uses your spellcasting roll for the attack. When used the arrows explode into a 3x3 tile cloud of black smoke. All creatures in the smoke make a Stamina save against your spellcasting roll. On failure they take a wound and a wound die in death damage, becoming blind until the end of their next turn on a critical.', 'You conjure an additional arrow for every level cast above 2nd.'] },
        "binding": { stat: "wil", prof: "curse", level: 2, ap: "7 AP", range: "10", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to bind a creature you can see in shimmering chains. Make a spellcasting roll against the creatures Dexterity save, adding 2 bad dice if the creature is large or bigger. On success the creature is restrained for the duration. A restrained creature can spend 5 AP to try and break the chains, making a Strength save against your spellcasting roll. On success they are no longer restrained.', 'You can target an additional creature for every level cast above 2nd.'] },
        "cloud-of-teeth": { stat: "wil", prof: "curse", level: 2, ap: "6 AP", range: "self", duration: "concentration, 10 minutes", dmgType: "piercing", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a swirling cloud of teeth around yourself. If you roll 4 or less defense dice you add a defense die, otherwise replace a defense die with a superior defense die. The cloud extends to all adjacent tiles. Any creature that enters the cloud for the first time this round or starts their turn there makes a defense roll against your spellcasting roll. On hit they take a wound in piercing damage and gain slow 1 until the end of their next turn.', "The cloud's area increases by 1 and you add or improve a defense die for each level cast above 2nd."] },
        "command": { stat: "wil", prof: "curse", level: 2, ap: "7 AP", range: "10", duration: "8 hours", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to force a creature in range to obey a given command or simple task. This spell automatically fails if the creature cannot be charmed, does not speak your language, or would harm the creature. The command can be no more than one sentence and must be someting they can reasonably complete. For example, commanding a commoner to kill a dragon or hurt their friends will fail, but asking a peasant to buy you a drink wont.', "Make a spellcasting roll against the creatures Willpower save. On success they must complete the command to the best of their abilities. The spell ends when they have completed their task or they take damage. Creatures don't immediately know they were under the spells effects, but do remember their actions.", 'Add an enhanced die for every level cast above 2nd.'] },
        "corpse-explosion": { stat: "wil", prof: "curse", level: 2, ap: "7 AP", range: "10", duration: "instant", dmgType: "death", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cause a large or smaller corpse to explode, launching sharp bone shards at nearby creatures. Medium and smaller creatures explode hitting all adjacent creatures, while large creatures explode hitting all creature within 2 tiles. Make a spellcasting roll against the creatures Stamina save. On success they gain poison 1 for 1 minute and take a wound in death damage, adding an wound die on a critical. A creature caught in multiple blasts takes an extra wound die per blast.', 'You may target an additional corpse for each level cast above 2nd.'] },
        "curse-of-fragility": { stat: "wil", prof: "curse", level: 2, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with fragility. Make a spellcasting roll against the creatures Willpower save. On success they add a bad die to their defense rolls, or a terrible die on a critical. This effect can only be removed by _Break Curse_ or similar spells.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 2nd.'] },
        "curse-of-suffering": { stat: "wil", prof: "curse", level: 2, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see, extending their suffering. Make a spellcasting roll against their Willpower save. On success any negative condition affecting the creature lasts an additional turn after being removed. Negative conditions last an additional turn even if removed through magic, such as with _Cleanse_. On a critical any time they gain hex, slow, or poison they gain an additional level of that condition.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 2nd.'] },
        "dark-sight": { stat: "wil", prof: "curse", level: 2, ap: "1 minute", range: "5", duration: "1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Magically enhance the sight of up to 5 creatures, giving them the ability to see in the dark. Make a spellcasting roll against a bad die for each creature targeted. On success they are able to see through dim light and darkness within 30 tiles as if they were bright light.', 'Add an enhanced die for every level cast above 2nd.'] },
        "dull-intellect": { stat: "wil", prof: "curse", level: 2, ap: "6 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to cloud the mind of a creature in range you can see. Make a spellcasting roll against the creatures Intelligence save. On success the creature adds a bad die to all spellcasting rolls, or a terrible die on a critical.', 'You may target an additional creature for each level above 2nd.'] },
        "howling-whirlwind": { stat: "wil", prof: "curse", level: 2, ap: "7 AP", range: "10", duration: "1 minute", dmgType: "bludgeoning", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a spiraling mass of wind covering a 3x3 tile area centered on a point in range. Any creature that enters the wind for the first time this round or starts their turn there makes a Strength save against your spellcasting roll. On failure they are pushed 2 tiles away from the wind and take 1 wound in bludgeoning damage. Any mundane projectile firing through the whirlwind adds a terrible die to their attack roll.', 'For the duration, starting on your next turn you may move the whirlwind up to 3 tiles once per turn as a free action.', 'The area of the whirlwind increases by 2 for every level cast above 2nd. When cast at 5th level and above the whirlwind can damage buildings and can push large, heavy objects, such as barrels or carts.'] },
        "mass-web": { stat: "wil", prof: "curse", level: 2, ap: "6 AP", range: "10", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a mass of webs in a 5x5 tile area centered on a point in range you can see. When a creature enters the web for the first time this round or starts their turn there they make a Dexterity save against your spellcasting. On failure they are grappled, or restrained on a critical. A creature effected by your webs can be freed by making a successful attack against 3 defense dice. Any creature in range is capable of making this attack.', 'The webs are extremely flammable and ignite after taking 1 wound of fire damage. Any creature caught in the webs takes 1 wound of fire damage and is freed. After the duration the webs remain but lose their stickiness, becoming difficult terrain until cleared.', 'Add an enhanced die and increase the area by 1 for every level cast above 2nd.'] },
        "silent-passage": { stat: "wil", prof: "curse", level: 2, ap: "1 minute", range: "5", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You emanate an aura of silence around yourself, extending out to a 5 tile radius. Make a spellcasting roll against 2 terrible dice. On success each creature within range of you adds the successes from your roll to any sound based stealth check while inside the aura. Creatures in the aura do not leave tracks and sounds are greatly inhibited.', 'Add an enhanced die for every level cast above 2nd.'] },
        "apathy": { stat: "wil", prof: "curse", level: 3, ap: "7 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Suppress a creatures natural abilities. Make a spellcasting roll against the creatures Willpower save. On success you choose either Strength or Dexterity. The creature loses 2 to their proficiency modifier for all skills, saving throws, and weapon attacks using that attribute, decreasing by 1 for every critical.', 'You may target an additional creature for each level above 3rd.'] },
        "curse-of-weakness": { stat: "wil", prof: "curse", level: 3, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with weakness. Make a spellcasting roll against the creatures Willpower save. On success, they are weakened, being unable to inflict lesser or greater wounds with attacks on a critical.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 3rd.'] },
        "enlarge/reduce": { stat: "wil", prof: "curse", level: 3, ap: "6 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Change a creatures size, either doubling or reducing it by half. When targeting an unwilling creature they make a Stamina save against your spellcasting roll. On fail, you choose if they are enlarged or reduced for the duration. This has no effect on huge or larger creatures.', '- Enlarge: Your body doubles in all proportions, increasing your size by 1 level. You add 1 superior die to all Strength skills, attacks and saves, and 1 terrible die to all Dexterity skills, attacks and saves. Attacks you make deal an extra wound in damage.', '- Reduce: Your body halves in all proportions, decreasing your size by 1 level. You add 1 terrible die to all Strength skills, attacks and saves, and 1 superior die to all Dexterity skills, attacks and saves. Attacks you make replace all wounds dealt with wound dice.', 'You may target an additional creature for every level cast above 3rd. All targets must either be enlarged or reduced.'] },
        "false-aura": { stat: "wil", prof: "curse", level: 3, ap: "10 AP", range: "touch", duration: "24 hours", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cover up to 5 creatures or objects in a false aura, changing how they appear to magical detection, such as _Detect Magic_ or _Identify_. Make a spellcasting roll adding 2 bad dice per object or creature. On success, you may do any of the following:', "- You can cause a mundane object to appear magical, a magical object appear mundane, or change it's magical aura to belong to a different school. For example, you could cause an arcane effect to appear as divine when seen by _Detect Magic_.", '- You can change how a creature appears to spells, such as disguising an undead creature as a human for the effects of _Consecrate Ground_.', '- You may change how their race, type, or size appears to spells. Spells restricted to a type or size of creature use their original type and size. For example _Bind Creature_ still adds bad dice against large creatures even if they are under the effects of this spell to appear as a medium creature.', 'If you cast this spell on a creature or object with the same effect every day for 30 days the aura becomes permanent, lasting until dispelled.', 'The spell lasts an additional 24 hours for every level cast above 3rd.'] },
        "fearful-presence": { stat: "wil", prof: "curse", level: 3, ap: "7 AP", range: "15", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You assume a horrifying visage, fearing up to 5 creatures in range that can see you. Make a spellcasting roll, adding 1 bad die for every creature targeted after the first, against the creatures Willpower save. On success the creatures are feared with you as the source. Each time they take damage they make a Willpower save against your spellcasting roll, ending the effect on success.', 'Add an enhanced die for every level cast above 3rd.'] },
        "frog-morph": { stat: "wil", prof: "curse", level: 3, ap: "7 AP", range: "5", duration: "1 minute", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Attempt to turn a creature you can see into a harmless frog. Make a spellcasting roll against the creatures Stamina save, adding 1 terrible die if the creature's size is large, or 2 terrible dice if they are huge or greater. On success the creature turns into a harmless frog. Items they are wearing are transformed with them, but anything they were holding drops to the ground.", 'The creature spends its turns hopping around, moving a single tile in a random direction. The Frog has 1 wound and rolls 1 defense die. If reduced to 0 wounds the spell ends and the creature reverts to their old form, taking any remaining damage.', 'You may target an additional creature for every level cast above 3rd. If you try to cast this on multiple creatures larger than medium you add the terrible dice based on size across all creatures.'] },
        "inflict-wound": { stat: "wil", prof: "curse", level: 3, ap: "6 AP", range: "touch", duration: "instant", dmgType: "death", dmg: [2, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['touch a creature, inflicting mortal wounds. Make a spellcasting roll against the creatures Stamina save. On success they take 2 wounds and a wound die in death damage, adding a wound die for every critical rolled. On failure they take half damage, rounding down. If this deals at least 3 wounds the target gains a random lesser wound, or a random greater wound if it deals 5 wounds or more.', 'Add a wound die for every level cast above 3rd.'] },
        "shapechange": { stat: "wil", prof: "curse", level: 3, ap: "7 AP", range: "self", duration: "1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You transform your body into a dangerous beast. The creature must have a CR of 5 or lower and be a beast you have seen before. While in this shape your max wounds become the max wounds of the creature and you take its Strength, Dexterity, and Stamina scores if they are higher, keeping your Intelligence, Willpower, and Charisma scores. You gain all abilities, attacks, and features of the creature. While transformed you can only use the beasts attacks and maneuvers, but you are still able to cast spells as normal.', 'Make a spellcasting roll, your max wounds are increased by 1 for every critical rolled. If you are reduced to 0 wounds while in this form the spell ends and you transform back to your normal shape, taking 2 wounds of damage and are stunned until the end of your next turn from the strain.', 'Add an enhanced die and increase the CR by 3 for every level cast above 3rd.'] },
        "shifting-image": { stat: "wil", prof: "curse", level: 3, ap: "7 AP", range: "self", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Your form blurs as 3 illusory projections of yourself hide your true position. Any time you would be attacked by a single target attack, spell, or maneuver, the attacker must roll a perception check against your roll. On failure the attack misses destroying one of the illusions. The spell ends once all illusions have been destroyed. A creature that can see through ilusions is unaffected by this spell.', 'Add an enhanced die for every level cast above 3rd.'] },
        "shroud-of-darkness": { stat: "wil", prof: "curse", level: 3, ap: "5 AP", range: "10", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You shroud a 5x5 area centered on a point in range in a consuming darkness that extinguishes mundane light. All tiles in the area are treated as being in complete darkness. Any creatures that enter the darkness for the first time this round or start their turn there makes a Stamina save against your spellcasting roll. On fail they are blind until the end of their next turn. If a creature is maintaining a _Light_ spell inside the darkness they must make a spellcasting roll against your spellcasting roll, ending the spell on fail.', 'The area of the darkness increases by 2 for every level cast above 3rd.'] },
        "curse-of-slowness": { stat: "wil", prof: "curse", level: 4, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with an unnatural slowness. Make a spellcasting roll against the creatures Willpower save. On success all actions they take costs 1 extra AP, or 2 extra AP on a critical.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 4th.'] },
        "gloom": { stat: "wil", prof: "curse", level: 4, ap: "7 AP", range: "10", duration: "1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Inflict an area with a supernatural gloom centered on a point you can see within range. Make a spellcasting roll, with the total area of the gloom increasing by 2 for every success. Every undead creature inside the gloom adds 1 superior die to all rolls. Mundane lights only provides light to adjacent tiles and magical light spreads half as far. All undead inside the gloom regain 1 wound at the start of their turns while all healing effects on living creatures heal for half of their value, rounding up.', 'Add an enhanced die for every level cast above 4th.'] },
        "haste": { stat: "wil", prof: "curse", level: 4, ap: "9 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Enhance the speed of up to 5 willing creatures you can see. Make a spellcasting roll adding 2 terrible dice for each creature targeted. On success, all creatures have their move and sprint speeds increased by 3, have their max AP increased by 4, and gain 2 superior dice to their Dexterity saves. When the spell ends all creatures make an exhaustion roll against 2 bad and 1 terrible dice, gaining a level of exhaustion on fail.', 'Add an enhanced die for every level cast above 4th.'] },
        "instigate": { stat: "wil", prof: "curse", level: 4, ap: "8 AP", range: "10", duration: "10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You incite a crowd or group of creatures to violence. All creatures in a 7x7 tile area centered on a point in range must make a Willpower save against your spellcasting roll. On fail, non-hostile creatures begin to act violently, turning into an angry mob. The mob will provoke others, destroy or vandalize nearby buildings, carts, or other objects, and may attack other creatures. Hostile creatures effected by this spell lose any organization they have and recklessly attack their enemies. Each time a creature takes damage they make a Willpower save against 1 bad die, ending the effects of this spell on success.', 'Add an enhanced die for every level cast above 4th.'] },
        "laughing-skull": { stat: "wil", prof: "curse", level: 4, ap: "8 AP", range: "10", duration: "instant", dmgType: "fire/death", dmg: [0, 4], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You summon a flaming skull that screeches a hideous laughter. The skull appears in an adjacent tile and moves up to 5 tiles with the caster controlling its movement. Each creature the skull passed through makes a Willpower save against your spellcasting roll. On failure they take 2 wound dice in both fire and death damage, being feared until the end of their next turn on a critical. While feared they must use their move and sprint actions to move as far away from you as they can.', 'The distance the skull travels increases by 2 for every level cast above 4th.'] },
        "mass-hex": { stat: "wil", prof: "curse", level: 4, ap: "9 AP", range: "10", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You target a 4x4 tile area centered on a point in range, bestowing a potent hex to all creatures in the area. Make a spellcasting roll against the creatures Willpower save. On success each creature gains hex for 1 hour, increasing the level of hex by 1 for every critical.', 'Increase the area by 1 for every level cast above 4th.'] },
        "paralytic-cloud": { stat: "wil", prof: "curse", level: 4, ap: "7 AP", range: "10", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Summon a cloud of toxic spores in a 5x5 tile area centered on a point in range. Any creature that enters the cloud for the first time this round or starts their turn there makes a Stamina save against your spellcasting. On failure they are paralyzed until the end of their next turn.', 'Add an enhanced die for every level cast above 4th.'] },
        "raise-dead": { stat: "wil", prof: "curse", level: 4, ap: "10 AP", range: "2", duration: "1 day", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to raise a dead creature as a zombie, or take control of a zombie without an owner. You can target up to 4 medium sized corpses, 2 large corpses, or 4 zombies. Make a spellcasting roll, adding a bad die for each medium corpse and 2 terrible dice for each large corpse. When targeting zombies make a spellcasting roll against their Charisma save instead. On success, medium corpses are raised as zombies and large corpses raised as zombie ogres. They act on your turn and are under your control for 1 day, at which point they turn to mindless zombies.', 'You may target an extra medium or large corpse and add a superior die to your roll for every level cast above 4th.'] },
        "void-lure": { stat: "wil", prof: "curse", level: 4, ap: "9 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Attempt to break the barrier between this realm and the void. Make a spellcasting roll adding up to 3 terrible dice. On success a random outsider with a CR of 6 plus 2 per terrible die added heeds your call and is summoned to a point in range of your choosing. The exact creature summoned is determined by the GM, and multiple creatures may be summoned if their combined CR is less than the spells maximum. After summoning roll a wound die. On success the creature is friendly towards you for the next minute, otherwise the creature follows it's own whims.", 'For every successful casting of _Void Lure_ in this location in the past day, add a terrible die to the spellcasting roll. This die does not effect the CR of the summoned creature.', 'The CR of the summoned creature increases by 2 for every level cast above 4th.'] },
        "invisibility": { stat: "wil", prof: "curse", level: 4, ap: "10 AP", range: "2", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Turn yourself or another creature or an object invisible. Make a spellcasting roll against 2 terrible dice. On success the target becomes completely invisible while standing still. Moving causes a barely noticeable shimmer on the creature. Creatures may make a perception check against your spellcasting roll to see a moving creature, spotting them on success. Single target attacks, spells, and maneuvers against an invisible creature add 2 terrible dice to their rolls.', 'Add an enhanced die to your spellcasting roll, and you may target an additional creature or object for every level cast above 4th. When targeting multiple creatures add a terrible die for each creature targeted past the 1st.'] },
        "curse-of-pain": { stat: "wil", prof: "curse", level: 5, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with pain. Make a spellcasting roll against the creatures Willpower save. On success the creature takes an extra wound die every time they take damage, or a full wound on a critical.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 5th.'] },
        "heart-grip": { stat: "wil", prof: "curse", level: 5, ap: "9 AP", range: "7", duration: "instant", dmgType: "death", dmg: [0, 5], lroll: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0], txt: ['Reach out to a creature you can see and stop their heart. Make a spellcasting roll against the creatures Stamina save. On failure they take 5 wound dice in damage and all healing they receive is half as effective until they take a long rest, being stunned until the end of their next turn on a critical. On success they take half damage, rounded down, and have no additional effects. A creature already under the effects of _Heart Grip_ automatically saves.', 'Add a wound to the damage for every level cast above 5th.'] },
        "impale": { stat: "wil", prof: "curse", level: 5, ap: "8 AP", range: "touch", duration: "instant", dmgType: "piercing", dmg: [1, 3], lroll: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0], txt: ['A line of bones sprout from the ground, impaling all creatures in a 5 tile line. Make a spellcasting roll against the creatures defense. On success they take a wound and 3 wound dice in piercing damage and are impaled by the bones, restraining them in place. On failure the creatures take no damage and are grappled instead.', 'The bones extend 8 feet high and are permanent, blocking movement through those tiles. The bones have 1 wound and roll 3 superior defense dice when attacked. To free a grappled or restrained creature the bones holding that creature must be destroyed.', 'Add a wound to the damage and increase the length of the line by 1 tile for every level cast above 5th.'] },
        "mind-break": { stat: "wil", prof: "curse", level: 5, ap: "8 AP", range: "10", duration: "instant", dmgType: "psychic", dmg: [0, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to overpower the mind of a creature in range that can see you. You make a telepathic link to the creature, using your will to shatter their mind. Make a spellcasting roll against the creatures Intelligence save. On success they take a wound die in psychic damage for every success remaining in your roll. If you deal at least 1 damage the target is dazed for the next minute.', 'Add a normal die to the spellcasting roll for every level cast above 5th.'] },
        "suggestion": { stat: "wil", prof: "curse", level: 5, ap: "10 AP", range: "15", duration: "24 hours", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to influence a group of creatures, suggesting a course of action. You may choose as many creatures in range as you want, adding a terrible die for every 3 creatures targeted. The creatures must be able to understand you and be able to hear you.', 'Make a spellcasting roll against the creatures Willpower save. On success you may give the creatures a 1 or 2 sentence command for them to follow. The command may have a condition to it, such as help the next person they see. If they are unable to meet the conditions before the spell ends the command is ignored.', 'Creatures that are immune to charm are immune to this spell. The command must be something the creature can reasonably accomplish and cannot be obviously harmful to the creature. The spell ends if the creature has completed their task or they take a wound in damage.', 'Add an enhanced die for every level cast above 5th.'] },
        "true-sight": { stat: "wil", prof: "curse", level: 5, ap: "5 AP", range: "self", duration: "1 hour", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Enhance your vision, seeing through illusions, invisibility and the true forms of creatures. Make a spellcasting roll against 2 bad dice. On success you gain true sight out to 30 tiles.', 'The duration increases by 1 hour for every level cast above 5th.'] },
        "curse-of-fear": { stat: "wil", prof: "curse", level: 6, ap: "6 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with an unnatural fear. Make a spellcasting roll against the creatures Willpower save. On success the creature is feared as long as there is a hostile creature within 10 tiles, or is afraid of all creatures on a critical. A creature gains no benefits from resting while under this curse.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 6th.'] },
        "isolation": { stat: "wil", prof: "curse", level: 6, ap: "8 AP", range: "10", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You sever the connections surrounding a creature you can see, leaving them utterly isolated. Make a spellcasting roll against the creatures Charisma save. On success the creature loses any spells, abilities, or magical effects that did not come from their own magic. While isolated, magic that is not their own cannot reach them, they cannot be detected by magical means and they cannot be contacted through telepathy. Any powers given from a deity or other being cannot be used and they do not benefit from magic items while isolated.', 'Add an enhanced die for every level cast above 6th.'] },
        "miasma": { stat: "wil", prof: "curse", level: 6, ap: "9 AP", range: "5", duration: "10 minutes", dmgType: "poison/Death", dmg: [2, 2], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A thick miasma flows from your body, covering a 7x7 tile area centered on a point in range. The miasma flows around walls and down hills, but cannot climb more than 2 tiles. Any creature, except the caster, that enters the miasma for the first time this round or starts their turn there makes a Stamina save against your spellcasting roll. On failure they take a wound and 1 wound die in both poison and death damage, or half damage rounding down on success. A creature that fails its save gains poison 1 and hex 1 regardless of immunities or other effects until the start of their next turn.', 'The miasma is a thick, viscous cloud. Creatures inside the miasma can only see adjacent tiles. The caster can feel any creature in the miasma, bypassing the need for sight. If there is a strong wind, such as wind created by _Gust_, the miasma cloud moves 1 tile per turn in the direction of the wind.', 'The size of the miasma increases by 1 and you add an enhanced die to the spellcasting roll for every level cast above 6th.'] },
        "psychic-scream": { stat: "wil", prof: "curse", level: 6, ap: "8 AP", range: "self", duration: "instant", dmgType: "psychic", dmg: [0, 5], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You send out a wave of mental force to all creatures within 5 tiles of you. Make a spellcasting roll against the creatures Intelligence save. On success they take 5 wound dice in psychic damage and are dazed for 1 minute. If a creature fails by 4 or more they are incapacitated until the end of their next turn instead. On failure they take half damage and are dazed until the end of their next turn.', 'Add a wound die for every level cast above 6th.'] },
        "ritual-of-mordiggian": { stat: "wil", prof: "curse", level: 6, ap: "10 minutes", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Targeting a beast with an Intelligence of -1 or less or a willing creature you permanently alter their form. Make a spellcasting roll. On success the creature gains the _Nightmare_ template and increases their max wounds by 1 for every critical rolled. The spell can be undone by casting _Restoration_ on the creature.', 'Their max wounds increase by 1 for every level cast above 6th.'] },
        "curse-of-obedience": { stat: "wil", prof: "curse", level: 7, ap: "7 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see to obey your every command. Make a spellcasting roll against the targets Willpower save. On success the creature must follow your commands to the best of their ability. You cannot command the target to hurt itself or take an action that would obviously bring harm to the target, such as jumping off a cliff. However you may still command the creature to take dangerous actions, such as defending you from attackers.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 7th.'] },
        "gateway": { stat: "wil", prof: "curse", level: 7, ap: "1 minute", range: "5", duration: "10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a gateway to hell, the abyss, or the realms of creation. Make a spellcasting roll, adding 2 terrible dice if you have been to the realm before or 5 if you only have an intimate knowledge of it. Trying to open a gateway to a realm you have only heard in passing or have a vague knowledge of automatically fails. On success a gateway 4 tiles wide and 4 tiles tall opens at a point in range you can see. For the duration creatures on either side can freely pass through the gateway, appearing in an empty tile adjacent to the gateway.', 'Opening a gateway in the same area multiple times can cause rifts creating a permanent gateway between realms. Rifts can be repaired by casting this spell on an the rift against challenge dice determined by the GM.', 'You add a superior die to your roll for every level cast above 7th. At 9th level the casting time becomes 1 turn instead of 1 minute.'] },
        "gravity-well": { stat: "wil", prof: "curse", level: 7, ap: "9 AP", range: "15", duration: "concentration, 1 minute", dmgType: "Bludgeoning", dmg: [2, 2], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You create a crushing gravity well covering a 7x7 tile area centered on a point in range you can see. All loose objects are pulled towards the center, destroying mundane items. Any creature that enters the gravity well for the first time this round or starts their turn there make a Strength save against your spellcasting roll. On failure they are pulled into the center of the gravity well taking 2 wounds and 2 wound die in bludgeoning damage. On success they take no damage and their move and sprint speeds are reduced to 1 and cannot be improved. Creatures in the center take an additional wound and wound die in bludgeoning damage at the start of their turn.. Any mundane ranged attacks made over the gravity well automatically fail, being destroyed.', 'The radius of the gravity well increases by 1 and you add 1 wound die to each source of damage for every level cast above 7th.'] },
        "control": { stat: "wil", prof: "curse", level: 8, ap: "10 AP", range: "10", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Overpower the mind of a creature you can see, taking control of the creature. Make a spellcasting roll against the creatures Willpower save. On success you possess the creature, sensing through the creatures senses. For the duration you are incapacitated, instead taking actions for the creature during the creatures turn. Taking damage as the controlled creature causes you to make concentration checks as if you took the damage yourself. If the controlled creature dies while you are still in control of it you take 3 wounds of psychic damage and are stunned until the end of your next turn from the strain of dying.', 'Add a superior die for every level cast above 8th.'] },
        "curse-of-death": { stat: "wil", prof: "curse", level: 8, ap: "7 AP", range: "5", duration: "7 days", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Curse a creature you can see with sudden mortality. Make a spellcasting roll against the creatures Willpower save. On success, if their health drops to 7 wounds or below they instantly die, increasing the threshold by 1 for every critical.', 'You can only inflict a single curse on a creature at a time. Casting another curse, such as _Curse of Misfortune_, ends this curses effects.', 'You may target an additional creature for every level cast above 8th.'] },
        "power-word:-kill": { stat: "wil", prof: "curse", level: 9, ap: "11 AP", range: "10", duration: "instant", dmg: [0, 0], lroll: [3, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Speak a word and command a creature to die. Make a spellcasting roll, if the target creature has less wounds than you have successes the creature instantly dies.', 'Add 3 superior dice when cast at 10th level.'] },
        "seal": { stat: "wil", prof: "curse", level: 9, ap: "1 minute", range: "touch", duration: "10 years", dmg: [0, 0], lroll: [2, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Seal a creature, binding their body and spirit to the current location and preventing them from influencing their surroundings. Make a spellcasting roll against the creatures Willpower save, adding 5 terrible dice if the creature has half or more of its wounds. On success the creature is incased in a material based on your surroundings and is incapacitated.', 'While sealed, the creature cannot take damage, does not need to eat or breathe, and does not age. The creature cannot communicate through any means and any telepathic or magical link between this creature and others is severed. If the seal is damaged the creature is no longer incapacitated and the GM determines what actions the sealed creature can take. Destroying the seal ends the effects of this spell and returns the creature.', 'The seal slowly degrades over the duration. Casting this spell on a sealed creature refreshes the seal, repairing any damage and extends the duration to 10 years.', 'When cast at 10th level the duration increases to 100 years and you add 2 superior dice to your spellcasting roll.'] },


        "guidance": { stat: "cha", prof: "divine", level: 0, ap: "3 AP", range: "2", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Enchant up to 5 creatures you can see with divine guidance. Make a spellcasting roll adding a bad die for each creature targeted. On a success, the creatures can add an enhanced die to their next attack, maneuver, or damage-dealing spell roll, or a superior die on a critical.', 'Add an enhanced die for every level cast above cantrip.'] },
        "holy-protection": { stat: "cha", prof: "divine", level: 0, ap: "4 AP", range: "2", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Enchant up to 5 creatures you can see with protection. Make a spellcasting roll adding a bad die for each creature targeted. On success the next die to roll a critical against this creature is ignored, counting as 0 successes.', 'Add an enhanced die for every level cast above cantrip.'] },
        "light": { stat: "cha", prof: "divine", level: 0, ap: "6 AP", range: "touch", duration: "concentration, 10 minutes.", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cause a small object no larger than a fist to emit a bright light. You may control the intensity of the light, from 1 tile of dim light up to 3 tiles of bright light and 3 tiles of dim light. The lights ranged can be doubled, requiring you to roll a concentration check against 1 bad die every turn. While intensifying the light, any creatures that are sensitive to bright light add 1 terrible die to their attack rolls while in this spells bright light.', 'The range of the maximum bright and dim light increases by 1 tile for every level cast above cantrip. At 5th level and above this light is considered sunlight.'] },
        "radiant-light": { stat: "cha", prof: "divine", level: 0, ap: "6 AP", range: "5", duration: "instant", dmgType: "holy", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A beam of radiant light envelops a creature in range. Make a spellcasting roll against the creatures Charisma save. On success they take 1 wound in holy damage, or 2 wounds if they are undead.', 'You may target an additional creature for every level cast above cantrip.'] },
        "spare-from-death": { stat: "cha", prof: "divine", level: 0, ap: "4 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Slow the heart and prevent blood loss of an incapacitated creature. Make a spellcasting roll against a bad die for every temporary wound the creature is missing. On success the creature is stabilized and will regain consciousness in 10 minutes with 1 wound.', 'Add a superior die for every level cast above cantrip.'] },
        "vine-whip": { stat: "cha", prof: "divine", level: 0, ap: "5 AP", range: "5 (10)", duration: "instant", dmgType: "Bludgeoning", dmg: [0, 2], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['Cause a plant to attack or grapple a nearby creature you can see. Choose a location in range to grow a plant, or take control of a small or larger plant within 10 tiles. The plant grows a bramble whip with _Reach 1_ it can use to attack creatures. You may use the plant to make an attack or grapple action using your spellcasting roll for the attack. On hit they take 2 wound dice in bludgeoning damage.', 'The plant lasts for 1 minute after which it withers or returns to its original shape.', 'Add a wound die for every level cast above cantrip.'] },
        "animal-messenger": { stat: "cha", prof: "divine", level: 1, ap: "1 minute", range: "touch", duration: "1 day", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to summon a small beast to deliver a message for you. Make a spellcasting roll against 2 bad dice, or 2 terrible dice in an urban environment. On success you summon a small beast local to the area, or a flying beast on a critical. You can give the beast a message up to 1 minute long and a description of the recipient. The beast will give the message to the first creature it finds that matches the description, and may have trouble with overly complex messages or descriptions. The beast can travel 20 miles a day, or twice that if they can fly.', 'On delivering the message the recipient is able to give a 1 minute message in return. If the beast is unable to find a creature matching that description or unable to return the response within the spells duration the beast reverts back to a normal animal and the message is lost.', 'The duration increases by 1 day for each level cast above 1st.'] },
        "bonfire": { stat: "cha", prof: "divine", level: 1, ap: "1 minute", range: "touch", duration: "8 hours", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a magical soothing bonfire. The bonfire takes up a tile of space, emits bright light for 5 tiles and dim light a further 5. Make a spellcasting roll against 2 bad dice. On success any creature that takes a long rest while in the fires light restores an extra wound and recovers an additional level of exhaustion.', 'Add an enhanced die for every level cast above 1st.'] },
        "bramble": { stat: "cha", prof: "divine", level: 1, ap: "7 AP", range: "7", duration: "5 minutes", dmgType: "piercing", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A 3x3 tile growth of razor sharp bramble appears centered on a point in range you can see. The bramble counts as difficult terrain and is flammable, each tile burning away after taking 1 wound of fire damage.', 'Any creature taking a move or sprint action through the bramble makes a Dexterity save against your spellcasting roll. On failure they take 1 wound die in piercing damage, being tangled in the bramble on a critical, ending their movement. A creature makes this save only once per move or sprint action.', 'The area increases by 1 for every level cast above 1st.'] },
        "breath": { stat: "cha", prof: "divine", level: 1, ap: "10 AP", range: "5", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You summon a swirling vortex of breathable air around up to 5 creatures in range you can see. Make a spellcasting roll, adding a bad die for every creature targeted. On success, each creature is able to breathe normally when they otherwise couldn't, such as when underwater, in a smoke filled room, or in a vacuum. Creatures also get expertise when saving against poisonous or harmful gasses, such as from the spells _Poison Cloud_ or _Miasma_.", 'Add an enhanced die for every level cast above 1st.'] },
        "chilling-fog": { stat: "cha", prof: "divine", level: 1, ap: "6 AP", range: "15", duration: "10 minutes", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A chilling fog covers a 5x5 tile area centered on a point in range you can see. A creature that enters the fog for the first time this round or starts their turn there makes a Stamina save against your spellcasting roll. On failure they gain slow 1 for the next minute, increasing to slow 2 on a crit. All creatures inside the fog have _Resistance 1_ to fire damage. The fog heavily obscures the area counting as quarter cover.', 'The size and range of the fog increases by 2 for every level cast above 1st.'] },
        "close-wounds": { stat: "cha", prof: "divine", level: 1, ap: "5 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Mend a creature's wounds. Make a spellcasting roll, healing a wound and adding a wound for every critical rolled.", 'Add a wound die for every level cast above 1st.'] },
        "holy-weapon": { stat: "cha", prof: "divine", level: 1, ap: "4 AP", range: "self", duration: "concentration, 1 minute", dmgType: "holy", dmg: [0, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Enchant your weapon with holy power. For the next minute you may use your spellcasting roll in place of attack rolls you make. Your attacks add an additional wound die of holy damage, or 3 wound dice if the target is undead.', 'Duration increases by 1 minute for every level cast above 1st.'] },
        "solar-flash": { stat: "cha", prof: "divine", level: 1, ap: "6 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You create a cone of shining light 3 tiles long and 3 tiles wide, blinding all creatures in the light. Make a spellcasting roll against the creatures Stamina save. On success the creatures are blinded until the end of their next turn. If the creature is sensitive to daylight or bright light they also take 1 wound in holy damage.', 'The length and width of the cone increases by 1 for every level cast above 1st.'] },
        "tremor": { stat: "cha", prof: "divine", level: 1, ap: "7 AP", range: "self", duration: "instant", dmgType: "Bludgeoning", dmg: [0, 1], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You cause tremors in the earth around you. All creatures within 2 tiles of you make a Strength save against your spellcasting roll. On failure the creatures takes 1 wound die in bludgeoning damage, being knocked prone on a critical. If the ground in the area is loose earth or stone it becomes difficult terrain until cleared.', 'The affected tiles extends by 1 and damage is increased by 1 wound die for every level cast above 1st.'] },
        "cleanse": { stat: "cha", prof: "divine", level: 2, ap: "3 AP", range: "3", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to remove negative conditions afflicting a creature in range that you can see. Make a spellcasting roll against a bad die for each condition you want to cleanse. For conditions with levels, such as poison, add 1 bad die for each level of that condition. On success you end the chosen conditions on the creature. This spell can remove slow, poison, hex, daze, stun, blind, weakened, and fear.', 'Add an enhanced die for every level cast above 1st.'] },
        "consecrate-ground": { stat: "cha", prof: "divine", level: 2, ap: "10 AP", range: "self", duration: "concentration, 10 minutes", dmgType: "holy", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Mark a 3x3 tile area centered on yourself. Any undead or monstrosity attempting to enter the consecrated ground makes a Charisma save against your spellcasting roll. On failure they cannot willingly enter. Any undead or monstrosity inside the consecrated ground takes 1 wound in holy damage at the start of their turn. Allies inside the zone gain 1 proficiency to all saving throws. Leaving the consecrated ground ends the spell. If the spell lasts for the full 10 minutes the area remains consecrated for 1 day.', 'The area increases by 2 for every level cast above 2nd.'] },
        "enhance-ability": { stat: "cha", prof: "divine", level: 2, ap: "5 AP", range: "3", duration: "concentration, 1 hour", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You bless up to 5 creatures in range that you can see. Make a spellcasting roll against a terrible die, adding a terrible die for each creature targeted. On success the creatures increase an attribute of their choosing by 1 for the duration of the spell, increasing the proficiency of that attributes saving throw for every critical.', 'Add an enhanced die for every level cast above 1st.'] },
        "gust": { stat: "cha", prof: "divine", level: 2, ap: "7 AP", range: "touch", duration: "concentration, 1 minute", dmgType: "Bludgeoning", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cause strong winds to blow down the length of a 10x2 tile line. On casting and at the start of each of your turns all creatures in the wind make a Strength save against your spellcasting roll. On failure they are pushed back 1 tile, or 2 tiles on a critical. If a creature is pushed into an obstacle or a tile with another creature they take 1 wound in bludgeoning damage. Any creature trying to move against the wind counts as moving through difficult terrain. On your turn or as a reaction you may spend 2 AP to reverse the direction of the wind.', 'Add an enhanced die for every level cast above 2nd.'] },
        "healing-word": { stat: "cha", prof: "divine", level: 2, ap: "5 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0], txt: ['Send healing energy to a creature in range you can see. Make a spellcasting roll against 3 bad dice. On success, the target heals a wound die for every success in your roll.', 'Add a normal die for every level cast above 2nd.'] },
        "seed-of-renewal": { stat: "cha", prof: "divine", level: 2, ap: "1 minute", range: "touch", duration: "10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Conjure a rejuvenating, fruit bearing bush. The bush can have up to 5 fruit, making a spellcasting roll, adding a bad die per fruit. On success a creature may eat one of the fruit during a short or long rest to restore a healing surge. They may also remove a poison or disease affecting them, unless the effect comes from a spell cast at a higher level than _Seed of Renewal_.', 'Add an enhanced die for every level cast above 2nd.'] },
        "shield-of-faith": { stat: "cha", prof: "divine", level: 2, ap: "5 AP", range: "3", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A shimmering aura protects up to 5 creatures in range that you can see. Make a spellcasting roll against a terrible die for each creature targeted. On success creatures add a defense die to their defense rolls, or a superior defense die on a critical.', 'Add an enhanced die for every level cast above 2nd.'] },
        "treat-injury": { stat: "cha", prof: "divine", level: 2, ap: "1 minute", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Restore a creatures body, healing injuries and mending bones. You may attempt to heal as many lesser and greater wounds as you wish. Make a spellcasting roll, adding 2 Bad dice for every lesser wound and 4 terrible dice for every greater wound. On success the effects of these wounds are removed.', 'Add an enhanced die for every level cast above 2nd.'] },
        "wall-of-faith": { stat: "cha", prof: "divine", level: 2, ap: "5 AP", range: "5", duration: "1 turn", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Channel your faith to form a protective wall 4 tiles wide and 4 tiles tall centered on a point in range you can see. Make a spellcasting roll adding 2 bad dice. On success the wall is created. The wall is transparent, blocking creatures and projectiles from passing through it. This can be cast as a reaction using 2 terrible dice instead of 2 bad dice. The wall lasts until the start of your next turn.', 'Add an enhanced die for every level cast above 2nd.'] },
        "winds-of-battle": { stat: "cha", prof: "divine", level: 2, ap: "4 AP", range: "5", duration: "1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A flurry of wind surrounds up to 5 willing creatures in range you can see. Make a spellcasting roll adding a terrible die for each creature targeted. On success the creatures do not provoke opportunity attacks when moving. For each critical rolled they can reroll a die in their attack, maneuver, or spell attack rolls. The effect ends on a creature if it takes damage.', 'Add an enhanced die for every level cast above 2nd.'] },
        "beacon": { stat: "cha", prof: "divine", level: 3, ap: "6 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You project an aura around up to 5 creatures protecting them from harm. Make a spellcasting roll adding a terrible die for each creature targeted. On success any time a creature would need to make a Willpower save they may use your spellcasting roll instead. When making death saving throws they may reroll their wound die, taking either result.', 'Add an enhanced die for every level cast above 3rd.'] },
        "break-curse": { stat: "cha", prof: "divine", level: 3, ap: "10 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to remove a curse afflicting a creature. Make a spellcasting roll against a bad die per spell level of the curse. On success the curse is removed.', 'Add an enhanced die for every level cast above 3rd.'] },
        "cure": { stat: "cha", prof: "divine", level: 3, ap: "10 AP", range: "3", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You cleanse poison and disease from up to 5 creatures you can see. Make a spellcasting roll adding a terrible die for each creature targeted. On success you end all poisons affecting them and cure one disease.', 'Add an enhanced die for every level cast above 3rd.'] },
        "demonic-skull": { stat: "cha", prof: "divine", level: 3, ap: "8 AP", range: "5", duration: "1 minute", dmgType: "fire", dmg: [1, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You summon a flaming skull at position in range you can see. At the end of each of your turns the skull breathes fire at all creatures in its zone of control. Make a spellcasting roll against the creatures defense. On success they take 1 wound in fire damage, adding a wound die on a critical. On your turn you may spend 3 AP to move the skull up to 5 tiles and change its facing. If the skull moves more than 10 tiles from you the spell ends.', 'Add an enhanced die and increase the duration by 1 turn for every level cast above 3rd.'] },
        "detect-creatures": { stat: "cha", prof: "divine", level: 3, ap: "1 minute", range: "1 mile", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to detect the location of a type of creature in range. Choose one of the following: _beast, celestial, construct, demon, draconic, elemental, giant, goblinoid, fey, humanoid, monstrosity, undead_, or _outsider_. Make a spellcasting roll adding 2 bad dice. On success you know the rough direction and Strength of creatures matching that type in the spells range. The spells accuracy is determined by how many success are in your roll:', '- **0-2**: You cannot sense how many creatures have been detected and their direction is accurate to within 2000 ft.', '- **3-4**: You have a vague count of the number of creatures in range, within 10, and their direction is accurate to within 500 ft.', '- **5-7**: You have a moderate idea of the number of creatures in range, within 5, and their direction is accurate to within 100 ft.', '- **8+**: You know exactly how many creatures are in range and their direction is accurate to within 10 ft.', 'The range increases by 1 mile for every level cast above 3rd.'] },
        "revive": { stat: "cha", prof: "divine", level: 3, ap: "10 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to bring back a creature back to life that has been dead for no longer than 10 minutes. Make a spellcasting roll against 2 terrible dice, adding a terrible die for every time this creature has died. On success the creature is brought back to life with 1 wound. For the next 3 days their attribute scores are reduced by 1.', 'Add a normal die for every level cast above 3rd.'] },
        "spirit-animal": { stat: "cha", prof: "divine", level: 3, ap: "10 minutes", range: "self", duration: "3 days", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Attempt to commune with local nature spirits, gaining one as your guide. Make a spellcasting roll adding 2 terrible dice, or 3 if you are not in a forest, swamp, or plains. On success you gain an spirit companion of your choosing. You may summon or dismiss the spirit for 5 AP, appearing in a tile adjacent to you. Each spirit has 3 wounds with the spell ending if they are killed. Spending a minute in concentration you may look through your spirit animal's eyes. While doing so you gain the senses of the animal and lose your own. Besides their max wounds the spirit animal has the same attributes, abilities, and attacks as the animal they're based on. You gain the following bonuses if the spirit animal is within 10 tiles of you.", '- **Elk:** You add 2 superior dice with athletics checks and your move speed increases by 1.', '- **Rabbit:** You add a superior die to Dexterity saves and acrobatics checks. The rabbit has 1 wound cannot be hurt while on your person.', '- **Bear:** Your max wounds increase by 1.', '- **Snake:** You add 1 superior die to Intelligence saves and you cannot be charmed. The snake has 1 wound and cannot be hurt while on your person.', '- **Eagle:** You add 2 superior dice to perception checks. The eagle has a flying speed of 5/5.', '- **Wolf:** You add 1 superior die to conversation and diplomacy checks. When helping or being helped by an ally you may reroll 3 dice.', 'Add an enhanced die for every level cast above 3rd.'] },
        "summoning": { stat: "cha", prof: "divine", level: 3, ap: "10 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to summon a willing creature to your location. Make a spellcasting roll, adding dice according to the table below. On success the creature is summoned to the location you touch. The creature gets a glimpse of the area they are being summoned to when the spell is cast and may refuse the summons.', "You may instead cast this into a small object or trinket using the 'Passing Acquaintance' difficulty. Successfully casting this in the same location every day for 3 days permanently binds the spell to the object. A creature holding the object that speaks the command word is teleported to the casting location. After using it reverts to a mundane object.", 'Add an enhanced die for every level cast above 3rd.'] },
        "traveler's-protection": { stat: "cha", prof: "divine", level: 3, ap: "3 minutes", range: "5", duration: "8 hours", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["Create a protective ward that fills up to 5 creatures with vigor. Make a spellcasting roll adding a bad die for each creature targeted. On success the creatures maximum wounds increase by 1. Casting _Traveler's Protection_ on a creature already under its effects refreshes the duration.", 'Add an enhanced die for every level cast above 3rd.'] },
        "turn-undead": { stat: "cha", prof: "divine", level: 3, ap: "6 AP", range: "self", duration: "1 minute", dmgType: "holy", dmg: [2, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0], txt: ['You create a wave of holy force. All undead within 3 tiles of you makes a Charisma save against your spellcasting roll. On failure they take 2 wounds in holy damage and are turned for 10 minutes. On success they take 1 wound and are not turned. An undead possessing a creature is forced to leave that creature if they are turned. While turned undead cannot sprint, attack, or take hostile actions and must spend their turn moving away from you. This effect lasts until they take damage.', 'Add a wound die and increase the area by 2 tiles for every level cast above 3rd.'] },
        "awaken": { stat: "cha", prof: "divine", level: 4, ap: "1 minute", range: "touch", duration: "7 days*", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to awaken a plant or creature with an Intelligence of -2 or less. Make a spellcasting roll adding a terrible die for every 4 CR of the creature, with a minimum of 1. On success the plant or creature is awakened, gaining intelligence. While within 1 mile of you the awakened creature can speak the languages you can speak as well as communicate with you telepathically. For the duration, the creature obeys your commands to the best of its ability. Once the spell ends, or if they move more than 1 mile from you, or if you dismiss them they revert to their original form.', 'Add a superior die for every level cast above 4th.'] },
        "bind-creature": { stat: "cha", prof: "divine", level: 4, ap: "6 AP", range: "5", duration: "concentration, 1 hour.", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Bind a creature in range you can see to this realm. Make a spellcasting roll against the creatures Charisma save. On success the creature is bound for the duration. While bound they are unable to leave this realm through any means, nor can they magically teleport, enter the ethereal plane, or possess a creature. Ethereal creatures are forced to the material plane, losing any resistances and cannot move through solid objects. The creature gains slow 1 for the duration on a critical.', 'Add an enhanced die for every level cast above 4th.'] },
        "commune-with-nature": { stat: "cha", prof: "divine", level: 4, ap: "10 minutes", range: "3 miles", duration: "instant", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You spend time in meditation, listening to the land itself covering an area 3 miles out in all directions. Make a spellcasting roll adding a bad die for each piece of information. On success you learn any of the following you've chosen:", '- General lay of the land and bodies of water.', '- Prevalent plants, creatures, or minerals.', '- Presence of fey, elemental, celestial, undead, or demonic entities, and an estimate of their strength.', '- General location and understanding of influence from other realms or warrens.', '- General location of any structures, cave systems, or traces of people (such as a campsite).', 'Add a superior die for every level cast above 4th.'] },
        "destroy-monstrosity": { stat: "cha", prof: "divine", level: 4, ap: "8 AP", range: "10", duration: "instant", dmgType: "holy", dmg: [7, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 2, 0, 0], txt: ['Channel holy energy to destroy an undead or monstrosity. Make a spellcasting roll against the creatures Stamina save. On success they take 7 wounds, or 2 wounds on failure. Regardless of success the creature gains slow 1 for 1 minute.', 'The number of wounds dealt increases by 2 for every level cast above 4th.'] },
        "purge": { stat: "cha", prof: "divine", level: 4, ap: "7 AP", range: "3", duration: "instant", dmgType: "lightning", dmg: [0, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to break the flow of magic around a creature or object, dispelling all magical effects targeting them. Make a spellcasting roll against 2 bad dice. Starting with the lowest level effect, subtract its spell level from your reminaing successes, if you have 0 or more the effect ends. Repeat this until every effect is dispelled or you have no remaining successes. The torn magic grounds itself through the creature, taking a wound die in damage for each effect purged. If the creature takes at least 1 wound they gain Slow 3 and are Paralyzed until the end of their next turn.', 'Add a normal die for every level cast above 4th.'] },
        "purify-spirit": { stat: "cha", prof: "divine", level: 4, ap: "8 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to purify a hostile celestial, fey, or elemental, returning it into a neutral or friendly state. Make a spellcasting roll against the creatures Charisma save. If they have less than half of their wounds remaining add 2 superior dice to your roll. On success they are no longer hostile to you or your allies, but not necessarily helpful. They remain this way for 24 hours or until you or an ally takes a hostile action against them.', 'Add an enhanced die for every level cast above 4th.'] },
        "regeneration": { stat: "cha", prof: "divine", level: 4, ap: "7 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Fill a creature with healing energy, causing their wounds to close over time. Make a spellcasting roll adding 4 bad dice. On success the creature heals a wound, healing a wound at the start of each of their turns. This effect lasts a number of turns equal to your successes. Remove a lesser wound on the creature for every critical rolled.', 'Add an enhanced die for every level cast above 4th.'] },
        "shape-stone": { stat: "cha", prof: "divine", level: 4, ap: "8 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to shape stone into a form of your choosing. Make a spellcasting roll adding 2 bad dice. On success an area of stone no larger than 2 tiles takes the form of your choosing. The stone can have multiple parts, but cannot be more complex than a door. You can shape the stone into anything following these constraints, such as a weapon, an statue, or a chair. This can be used to seal a door shut or create a passage way through a wall.', 'You number of tiles shaped increases by 2 for each level cast above 4th. The tiles must be adjacent.'] },
        "summon-demon": { stat: "cha", prof: "divine", level: 4, ap: "10 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You attempt to call forth a demon from the abyss at a point in range you can see. Make a spellcasting roll against 2 terrible dice. On success a group of demons (determined by the GM) whose combined CR is 8 or lower appear at the target location. When they appear the demons make a Willpower save against your raw Willpower. On failure the demons obey you for the next hour after which they revert to their default behavior. Each successful casting of _Summon Demon_ in this location over the past day adds 1 terrible die to your spellcasting roll.', 'The maximum CR increases by 3 for every level cast above 4th.'] },
        "ward-from-death": { stat: "cha", prof: "divine", level: 4, ap: "1 minute", range: "5", duration: "8 hours", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Cast a ward on up to 5 creatures, protecting them from death. Make a spellcasting roll against 2 terrible dice for each creature targeted. The next attack or spell that would either take them to 0 wounds or instantly kill them instead leaves them at 1 wound. Once triggered the spell ends on the creature.', 'Add an enhanced die to the roll for every level cast above 4th.'] },
        "bind-familiar": { stat: "cha", prof: "divine", level: 5, ap: "1 turn", range: "3", duration: "1 year", dmg: [0, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You bind a spirit to a beast to serve as your familiar. The creature must have a CR of 15 or less and an Intelligence score of -1 or less to become your familiar. Make a spellcasting roll adding a terrible die for every 3 CR of the creature. On success you call a spirit (75% chance for a celestial spirit, 25% chance for a demonic spirit) and bind it to the creature. The creature gains powers based on the spirit that inhabits it and gains the ability to speak and communicate telepathically with whoever they form a contract with.', 'Once bound, the familiar offers a contract to the caster in exchange for one year of service. The offer can include anything, such as a large sum of money, an attribute point for the duration of the contract, needing to feed on human flesh every 7 days, or tracking down and punishing a wicked creature. The offer will be determined by the GM, but regardless of the cost accepting the contract reduces your maximum wounds by 2 for the duration.', "You gain part of the familiar's powers while it is within 10 tiles of you. The powers granted are included in the contract and can be anything, such as giving you expertise in a spell school or saving throw, allowing you to turn invisible, read the minds of nearby creatures, or giving you a powerful maneuver.", 'Once successfully cast, regardless of whether a contract was formed this spell cannot be cast again for 7 days. You may only have a single familiar bound to you at once. The contract ends after the familiar dies or a year passes.', 'Add a superior die to your roll for every level cast above 5th.'] },
        "inner-fire": { stat: "cha", prof: "divine", level: 5, ap: "8 AP", range: "5", duration: "concentration, 10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Empower up to 5 creatures with righteous fury. Make a spellcasting roll adding a terrible die for each creature targeted. On success the creatures have expertise with all weapons and deal an extra wound die in holy damage with every attack.', 'Add an enhanced die for every level cast above 5th.'] },
        "judgement": { stat: "cha", prof: "divine", level: 5, ap: "10 AP", range: "10", duration: "instant", dmgType: "holy", dmg: [0, 5], lroll: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0], txt: ['You call down a holy judgement over a 5x5 tile area centered on a point in range you can see. All creatures of your choosing in the area makes a Charisma save against your spellcasting roll. On failure they take 5 wound dice in damage with Undead taking 5 wounds, or half damage, rounding down, on success. On a critical the creature cannot move until the end of their next turn. If the damage would kill a living creature they are brought to 1 wound instead and stunned until the end of their turn. Undead killed this way cannot be raised again.', 'Add a wound for every level cast above 5th.'] },
        "mass-healing-word": { stat: "cha", prof: "divine", level: 5, ap: "6 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0], txt: ['Mend the wounds of up to 5 creatures in range you can see. Make a spellcasting roll adding 3 terrible dice. On success you heal each creature for 1 wound, adding a wound die for every success in your roll.', 'Add a normal die for every level cast above 5th.'] },
        "mass-cleanse": { stat: "cha", prof: "divine", level: 5, ap: "6 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to remove afflictions from up to 5 creatures. Make a spellcasting roll adding a terrible die for each creature targeted. On success you remove two negative conditions affecting each creature. Mass Cleanse can remove slow, poison, hex, daze, stun, blind, weaken, fear, petrification, or a condition inflicted by a spell of 4th level or lower.', 'Add a normal die for every level cast above 5th.'] },
        "petrify": { stat: "cha", prof: "divine", level: 5, ap: "8 AP", range: "5", duration: "concentration, 1 minute", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Petrify a creature in range you that can see you, turning them to stone. Make a spellcasting roll against the creatures Stamina save. On success they are paralyzed for the next minute. You must maintain line of sight with the creature or the spell ends. After 1 minute you make another spellcasting roll against the creatures Stamina save. On success the creature is turned to stone.', 'You add a terrible die to your roll when cast on a large creature, or 3 terrible dice when cast on a huge or larger creature.', 'You may target an additional creature for every level cast above 5th.'] },
        "radiance": { stat: "cha", prof: "divine", level: 5, ap: "10 AP", range: "self", duration: "concentration, 10 minutes", dmgType: "holy", dmg: [1, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A holy light emanates bright light in 3 tiles and dim light a further 3. Any undead, demon, or monstrosity entering the bright light for the first time this round or starting their turn there makes a Stamina save against your spellcasting roll. On failure they take 1 wound in holy damage and are blind until the end of their next turn. Any creature making an attack roll against you adds a terrible die to their roll. You and any creatures you choose inside the light adds a superior die to all saving throws.', 'The radius of the bright light increases by 1 for every level cast above 5th.'] },
        "resurrect": { stat: "cha", prof: "divine", level: 5, ap: "10 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Attempt to bring back a creature that has died in the past week. A majority of the creature must be present, with this spell restoring missing body parts. Make a spellcasting roll against 2 bad dice, adding a terrible die for every time this creature has died in the past year. On success the crreature is brought back to life with 1 wound, adding a wound for every critical you rolled.', 'Add an enhanced die to the roll for every level cast above 5th.'] },
        "spirit-warriors": { stat: "cha", prof: "divine", level: 5, ap: "10 AP", range: "3", duration: "10 minutes", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You call upon the fighting spirit of nearby dead creatures. You may choose any number of corpses within range, except the corpses of undead, monstrosities, or constructs. Make a spellcasting roll adding a terrible die for each corpse. On success spirits of the creature rise from their bodies to defend you.', 'The spirits have the same attributes and proficiencies they had in life, but lose any maneuvers, abilities, or spells. Each spirit has 2 wounds in health and _Resistance 2_ for all physical damage from non-silvered weapons. The warriors act immediately and obey simple commands. The spirits vanish after the duration or when exposed to direct sunlight. Corpses that have been targeted by this spell cannot be used again.', 'Add an enhanced die for every level cast above 5th.'] },
        "exorcism": { stat: "cha", prof: "divine", level: 6, ap: "10 AP", range: "touch", duration: "instant", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You attempt to exorcise an undead, demon, fey, outsider, or celestial creature, returning them to their home realm. If the creature is in it's home realm it is instead banished to a warren, appearing within 40 miles of your location within the next hour. Make a spellcasting roll against the creatures Charisma save, adding a bad die if the creature has no negative conditions. On success the creature is banished to their home realm or warren, ending any possession or effects this creature was maintaining.", 'Add an enhanced die to the roll for every level cast above 6th.'] },
        "power-word:-harm": { stat: "cha", prof: "divine", level: 6, ap: "9 AP", range: "10", duration: "instant", dmgType: "holy", dmg: [6, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0], txt: ['Channel your divine wrath at a creature in range you can see. Make a spellcasting roll against the creatures Stamina save. On success the creature takes 6 wounds in holy damage, adding a wound die for every critical rolled. This damage bypasses any resistances. Damage dealt from this spell reduces the creatures maximum wounds an equal amount, recovering 1 max wound every day. casting _Power Word: Heal_ on a creature removes this effect.', 'Add a wound for every level cast above 6th.'] },
        "power-word:-heal": { stat: "cha", prof: "divine", level: 6, ap: "9 AP", range: "touch", duration: "instant", dmg: [6, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0], txt: ['Restore the body of a creature in range you can see. Make a spellcasting roll. The creature heals 6 wounds and removes all lesser and greater wounds, healing an extra wound for every critical rolled. A creature can only be healed by this spell once per long rest.', 'Add a wound for every level cast above 6th.'] },
        "sanctuary": { stat: "cha", prof: "divine", level: 6, ap: "7 AP", range: "touch", duration: "1 turn", dmg: [0, 0], lroll: [0, 1, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['When casting this spell you may choose to either mark a location as your sanctuary or open a portal to your sanctuary. When marking a location as your sanctuary the spell takes 1 hour to cast and does not require a roll.', 'When opening a portal it remains open until the end of your next turn and any creature you allow can enter it before it closes. Once the portal closes make a spellcasting roll adding 3 terrible dice. On success you appear at the location, otherwise you appear in a random location within 20 miles of your sanctuary. Regardless of the result it takes 1 minute to travel through the portal.', 'Add an enhanced die to the roll for every level cast above 6th.'] },
        "word-of-command": { stat: "cha", prof: "divine", level: 6, ap: "8 AP", range: "10", duration: "instant", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['Your voice bellows a single command heard by all creatures within 10 tiles of you. Any creatures you choose makes a Charisma save against your spellcasting roll, with hostile creatures adding a superior die to their save. On failure they obey your command. You may command the creatures to not take an action, such as preventing them from taking the move, attack, or defend actions. Alternatively you may command them to immediately take an action, such as clearing a path or dropping their weapons. Creatures commanded this way will only take the action if they have AP remaining and are capable of doing so. The command is either resolved immediately or lasts until the end of the creatures next turn if the command prevents them from taking an action.', 'Your voice carries an extra 5 tiles for every level cast above 6th.'] },
        "divine-word": { stat: "cha", prof: "divine", level: 7, ap: "9 AP", range: "10", duration: "instant", dmgType: "holy", dmg: [3, 0], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['You speak a divine word to smite any creatures in range that can hear you. Make a spellcasting roll against the creatures Charisma save. On success the following effects occur depending on the creatures remaining wounds, increasing the threshold by 1 for every critical rolled:', '- 8 wounds or fewer: blinded for 1 minute', '- 5 wounds or fewer: blinded and feared for 10 minutes', '- 3 wounds or fewer: killed instantly', 'Regardless of the outcome, any undead, demon, or celestial targeted by this spell takes 3 wounds in holy damage.', 'Add a superior die to your roll for every level cast above 7th.'] },
        "light-of-divinity": { stat: "cha", prof: "divine", level: 8, ap: "10 AP", range: "10", duration: "concentration, 5 minutes", dmgType: "holy", dmg: [0, 2], lroll: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ['A blinding light shines down covering a 5x5 tile area in sunlight centered on a point in range.  You may choose any number of creatures inside the light to be unaffected. All other creatures make a Charisma save against your spellcasting roll. On failure the creatures are pushed to the closest empty tile outside of the light and take 2 wound dice in holy damage.', 'Creatures inside the light are considered to be in a different realm and any attack or spell made through the the light fails. A creature can attempt to force their way into the light, making a Charisma save against your spellcasting roll. On success they enter the light as normal, otherwise they are burned by the light, taking 2 wound dice in holy damage and cannot enter.', 'Add a superior die and increase the area by 2 for every level cast above 8th.'] },
        "restoration": { stat: "cha", prof: "divine", level: 8, ap: "10 AP", range: "5", duration: "instant", dmg: [0, 0], lroll: [2, 0, 0, 0, 0, 0, 0, 0, 0, 0], txt: ["You restore a creature's body, ending negative effects on them and healing mortal wounds. Make a spellcasting roll, the creature restores wounds equal to the rolls successes. Any conditions afflicting the creature are removed if they came from a spell of 5th level or below. All lesser and greater wounds are removed.", 'Add 2 superior dice to your roll for every level cast above 8th.'] },
        "avatar": { stat: "cha", prof: "divine", level: 9, ap: "1 turn", range: "self", duration: "concentration, 10 minutes.", dmg: [0, 0], lroll: [0, 0, 0, 0, 0, 0, 0, 0, 0, 1], txt: ['You channel your magic to become a divine avatar. Make a spellcasting roll adding 3 terrible dice. On success you heal a wound die for each success in your roll. Starting on your next turn you become an embodiment of divine wrath, gaining the following effects:', '- You gain a flying speed equal to your move speed.', '- You gain Resistance 1 to all damage.', '- You have expertise in everything.', '- You add 2 superior dice to all saving throws.', 'Add a hero die to your spellcasting roll and you have _Resistance 2_ when cast at 10th level.'] },

    }

    var commandListener = function () {
        // Listens for API command
        on('chat:message', function (msg) {
            if (msg.type === 'api' && !msg.rolltemplate) {
                var processedMsg = processInlinerolls(msg);
                var params = processedMsg.substring(1).split(' '),
                    command = params[0].toLowerCase();
                params = params.slice(1, params.length);
                character = findObjs({ type: 'character', name: msg.who })[0];
                var player = getObj('player', msg.playerid);
                token = undefined;


                if (msg.selected != undefined) {
                    token = getObj('graphic', msg.selected[0]._id);
                    if (token !== undefined) {
                        character = getObj('character', token.get('represents'));
                    }
                }
                if (!character && player != undefined) {
                    character = findObjs({ type: 'character', controlledby: player.id })[0];
                }

                var msgFrom = character ? 'character|' + character.id : 'player|' + player.id;
                var result = "";
                var name = "";

                rollHistory = [];

                if (character === undefined) {
                    sendChat(msgFrom, 'No character selected. Select a token or change who your playing as.');
                    return;
                }

                if (command === 'skill') {
                    name = "Skill Check";
                    result = skillRoll(params);
                }
                else if (command === 'initiative') {
                    if (params.length < 5) {
                        sendChat(msgFrom, 'Need values for all dice types');
                        return;
                    }
                    initiative(msgFrom, params);
                }
                else if (command === 'attack') {
                    if (params.length < 5) {
                        sendChat(msgFrom, 'Need values for all dice types');
                        return;
                    }
                    name = "Attack";
                    result = attack(params);
                }
                else if (command === 'save') {
                    if (!character) {
                        sendChat(msgFrom, 'No character found for player, try changing your "As" in chat.');
                        return;
                    }
                    name = "Saving Throw";
                    result = saveRoll(params);
                }
                else if (command === 'roll') {
                    if (params.length < 5) {
                        sendChat(msgFrom, 'Need values for all dice types');
                        return;
                    }
                    name = "Roll";
                    result = customRoll(params);
                }
                else if (command === 'defend') {
                    if (params.length < 2) {
                        sendChat(msgFrom, 'Need values for all dice types');
                        return;
                    }
                    name = "Defend";
                    result = defend(params);
                }
                else if (command === 'wound') {
                    if (params.length < 2) {
                        sendChat(msgFrom, 'Need values for all dice types');
                        return;
                    }
                    name = "Wounds";
                    result = wound(params);
                }
                else if (command === 'hero') {
                    name = "Hero";
                    result = hero(params);
                }
                else if (command === 'rtmp') {
                    handleTemplateRoll(msgFrom, processedMsg);
                }
                else if (command === 'srr') {
                    togglereroll(params);
                }
                else if (command === 'rr') {
                    reroll(msgFrom);
                }
                else if (command === 'spell') {
                    spell(msgFrom, params);
                }
                else if (command === 'mana') {
                    var mana = parseInt(params[0]);
                    var manaAttr = getAttr("mana", 0);
                    manaAttr.set("current", manaAttr.get("current") - mana);
                    var msg = '<rolltemplate class="sheet-rolltemplate-CustomRoll"><div style="background-color: #ffffff; border: 1px solid; padding: 2px; width: 218px;">' +
                        '<div style="font-size: 0.9em"><span style="font-weight:bold">Cast: </span>Spent ' + mana + ' mana</div>' +
                        '</div></rolltemplate>';
                    sendChat(msgFrom, "/direct " + msg);
                }


                if (result != "") {
                    sendChat(msgFrom, "/direct " + makeTemplate({ name: name, rolls: { r: result }, text: {} }));
                }
            }
        });
    },

        processInlinerolls = function (msg) {
            if (_.has(msg, 'inlinerolls')) {
                return _.chain(msg.inlinerolls)
                    .reduce(function (previous, current, index) {
                        previous['$[[' + index + ']]'] = current.results.total || 0;
                        return previous;
                    }, {})
                    .reduce(function (previous, current, index) {
                        return previous.replace(index, current);
                    }, msg.content)
                    .value();
            } else {
                return msg.content;
            }
        },

        getDefaultMods = function () {
            var modObj = {
                bonus: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                hex: 0,
                poison: 0,
                success: 0,
                crit: 0
            };
            if (token !== undefined) {
                var markers = token.get("statusmarkers").split(',');
                for (var i = 0; i < markers.length; i++) {
                    var name = markers[i].split(':')[0];
                    if (name == 'poison1') {
                        modObj.poison = 1;
                    } else if (name == 'poison2') {
                        modObj.poison = 2;
                    } else if (name == 'poison3') {
                        modObj.poison = 3;
                    } else if (name == 'hex1') {
                        modObj.hex = 1;
                    } else if (name == 'hex2') {
                        modObj.hex = 2;
                    } else if (name == 'hex3') {
                        modObj.hex = 3;
                    }
                }
            }
            return modObj;
        },

        getMods = function (param) {
            var modObj = getDefaultMods();
            if (param.substring(0, 1) === 'b') {
                var vals = param.substring(1).split('-');
                for (var i = 0; i < vals.length; i++) {
                    if (vals[i].length < 2) {
                        continue;
                    }
                    var sub1 = vals[i].substring(0, 1), sub2 = vals[i].substring(0, 2);
                    if (sub1 === 's' && sub2 !== 'sd' && sub2 !== 'sc') {   // SUPERIOR
                        modObj.bonus[0] += parseInt(vals[i].substring(1));
                    } else if (sub1 === 'e') {                              // ENHANCED
                        modObj.bonus[1] += parseInt(vals[i].substring(1));
                    } else if (sub1 === 'n') {                              // NORMAL
                        modObj.bonus[2] += parseInt(vals[i].substring(1));
                    } else if (sub1 === 'b') {                              // BAD
                        modObj.bonus[3] += parseInt(vals[i].substring(1));
                    } else if (sub1 === 't') {                              // TERRIBLE
                        modObj.bonus[4] += parseInt(vals[i].substring(1));
                    } else if (sub2 === 'sd') {                             // SUPERIOR DEFENSE
                        modObj.bonus[5] += parseInt(vals[i].substring(2));
                    } else if (sub1 === 'd') {                              // DEFENSE
                        modObj.bonus[6] += parseInt(vals[i].substring(1));
                    } else if (sub1 === 'w') {                              // WOUND DIE
                        modObj.bonus[8] += parseInt(vals[i].substring(1));
                    } else if (sub2 === 'gw') {                             // WOUND
                        modObj.bonus[7] += parseInt(vals[i].substring(2));
                    } else if (sub1 === 'h') {                              // HERO
                        modObj.bonus[9] += parseInt(vals[i].substring(1));
                    } else if (sub2 === 'cs') {                             // CRIT SUCCESS
                        modObj.crit += parseInt(vals[i].substring(2));
                    } else if (sub2 === 'cf') {                             // CRIT FAIL
                        modObj.crit -= parseInt(vals[i].substring(2));
                    } else if (sub2 === 'sc') {                             // SUCCESS
                        modObj.success += parseInt(vals[i].substring(2));
                    } else if (sub1 === 'f') {                              // FAIL
                        modObj.success -= parseInt(vals[i].substring(1));
                    }
                }
            }
            return modObj;
        },
        getAttr = function (attrName, defaultValue) {
            var attr = findObjs({ type: 'attribute', characterid: character.id, name: attrName }, { caseInsensitive: true })[0];
            if (!attr) {
                attr = createObj("attribute", { name: attrName, current: defaultValue, characterid: character.id });
            }
            return attr;
        },
        getAttrDice = function (attribute, proficiency, allowNegatives = true) {
            var exhaustion = parseInt(getAttr("exhaustionstack", 0).get("current"));
            proficiency += exhaustMod[exhaustion];
            var attributeUnder5 = Math.min(5, attribute);
            var attributeOver5 = Math.max(0, attribute - 5);
            var proficiencyOver5 = Math.max(0, proficiency - 5);

            // We start with White dice
            var dice = [0, 0, 5 + attributeOver5, 0, 0, 0, 0, 0, 0, 0];
            // Improve White to Green for every attribute point
            if (attributeUnder5 > 0) {
                dice[1] += attributeUnder5;
                dice[2] -= attributeUnder5;
            } else {
                if (allowNegatives === true) {
                    dice[3] -= attributeUnder5;
                    dice[2] += attributeUnder5;
                }
            }
            // Improve Green to Yellow for every proficiency point
            if (proficiency > 0) {
                var maxProf = Math.min(dice[1], proficiency);
                dice[0] += maxProf;
                dice[1] -= maxProf;
            } else {
                if (allowNegatives === true) {
                    var greenToWhite = Math.min(dice[1], -proficiency);
                    var redToPurple = Math.min(dice[3], (-proficiency) - greenToWhite);
                    dice[1] -= greenToWhite;
                    dice[2] += greenToWhite;
                    dice[3] -= redToPurple;
                    dice[4] += redToPurple;
                }
            }
            // Attributes over 5 add White/improve to Green dice.
            if (attributeOver5 > 0 && proficiencyOver5 > 0) {
                var maxProf = Math.min(dice[2], proficiencyOver5);
                dice[1] += maxProf;
                dice[2] -= maxProf;
            }

            return dice;
        },

        saveRoll = function (params) {
            var modObj = params.length > 1 ? getMods(params[1]) : getDefaultMods();
            var statVal = parseInt(getAttr(params[0], -1).get("current"));
            var statProf = 0;

            switch (params[0]) {
                case 'str':
                    statProf = parseInt(getAttr("strsave", 0).get("current"));
                    break;
                case 'dex':
                    statProf = parseInt(getAttr("dexsave", 0).get("current"));
                    break;
                case 'sta':
                    statProf = parseInt(getAttr("stasave", 0).get("current"));
                    break;
                case 'int':
                    statProf = parseInt(getAttr("intsave", 0).get("current"));
                    break;
                case 'wil':
                    statProf = parseInt(getAttr("wilsave", 0).get("current"));
                    break;
                case 'cha':
                    statProf = parseInt(getAttr("chasave", 0).get("current"));
                    break;
            }

            var dice = getAttrDice(statVal, statProf, false);

            return roll(dice, modObj)
        },

        skillRoll = function (params) {
            var modObj = params.length > 2 ? getMods(params[2]) : getDefaultMods();
            var statVal = parseInt(params[0]);
            var statProf = parseInt(params[1]);

            var dice = getAttrDice(statVal, statProf);

            return roll(dice, modObj);
        },

        customRoll = function (params) {
            var modObj = params.length > 5 ? getMods(params[5]) : getDefaultMods();
            modObj.poison = 0;

            var diceVals = [parseInt(params[0]), parseInt(params[1]), parseInt(params[2]), parseInt(params[3]), parseInt(params[4]), 0, 0, 0, 0, 0];

            return roll(diceVals, modObj);
        },

        attack = function (params) {
            var modObj = params.length > 5 ? getMods(params[5]) : getDefaultMods();
            var diceVals = [parseInt(params[0]), parseInt(params[1]), parseInt(params[2]), parseInt(params[3]), parseInt(params[4]), 0, 0, 0, 0, 0];

            return roll(diceVals, modObj);
        },

        initiative = function (msgFrom, params) {
            var diceVals = [parseInt(params[0]), parseInt(params[1]), parseInt(params[2]), parseInt(params[3]), parseInt(params[4]), 0, 0, 0, 0, 0];

            var modObj = params.length > 5 ? getMods(params[5]) : getDefaultMods();

            var msg = roll(diceVals, modObj);
            var total = rollHistory[rollHistory.length - 1].s;

            var turnOrder = Campaign().get("turnorder") ? JSON.parse(Campaign().get("turnorder")) : [];
            var added = false;
            for (var i = 0; i < turnOrder.length; i++) {
                if (total > turnOrder[i].pr) {
                    turnOrder.splice(i, 0, { id: "-1", pr: total.toString(), custom: character.get("name"), _pageid: Campaign().get("playerpageid") });
                    added = true;
                    break;
                }
            }
            if (added == false) {
                turnOrder.splice(i, 0, { id: "-1", pr: total.toString(), custom: character.get("name"), _pageid: Campaign().get("playerpageid") });
            }
            Campaign().set("turnorder", JSON.stringify(turnOrder));

            sendChat(msgFrom, "/direct " + makeTemplate({ name: "Initiative", rolls: { r: msg }, text: {} }));
        },

        defend = function (params) {
            var diceVals = [0, 0, 0, 0, 0, parseInt(params[0]), parseInt(params[1]), 0, 0, 0];
            var modObj = params.length > 2 ? getMods(params[2]) : getDefaultMods();
            modObj.poison = 0;

            return roll(diceVals, modObj);
        },

        hero = function (__params) {
            var modObj = getDefaultMods();
            modObj.hex = 0;
            modObj.poison = 0;

            return roll([0, 0, 0, 0, 0, 0, 0, 0, 0, 1], modObj);
        },

        wound = function (params) {
            var modObj = params.length > 2 ? getMods(params[2]) : getDefaultMods();
            modObj.poison = 0;
            modObj.hex = 0;
            var diceVals = [0, 0, 0, 0, 0, 0, 0, parseInt(params[0]), parseInt(params[1]), 0];
            if (character) {
                var weaken = parseInt(getAttr("weaken", 0).get("current"));
                if (weaken == 1) {
                    diceVals[1] += diceVals[0];
                    diceVals[0] = 0;
                }
            }
            return roll(diceVals, modObj);
        },

        togglereroll = function (params) {
            //toggle the reroll status of a die in the last roll.
            var rolls = state.FarhomeDice.lastRolls[character.id];

            if (rolls === undefined) {
                return;
            }
            //exit early if there is no roll history
            if (rolls.length === 0) {
                return;
            }

            var idx = [parseInt(params[0]), parseInt(params[1])];
            // if for some reason the values don't line up (eg: old rolls, other players trying to toggle rolls) don't do anything
            if (idx[0] >= rolls.length || idx[1] >= rolls[idx[0]].d.length) {
                return;
            }
            rolls[idx[0]].r[idx[1]] = !rolls[idx[0]].r[idx[1]];

            state.FarhomeDice.lastRolls[character.id] = rolls;
        },

        reroll = function (msgFrom) {
            rollHistory = state.FarhomeDice.lastRolls[character.id];
            if (rollHistory === undefined) {
                return;
            }
            var values = { name: "Reroll", rolls: {}, text: {} };
            for (var i = 0; i < rollHistory.length; i++) {
                var rollMsg = "<span>";
                for (var t = 0; t < rollHistory[i].d.length; t++) {
                    // we can't reroll hexes
                    if (rollHistory[i].v[t] === -1) {
                        var imgSource = (rollHistory[i].d[t] == 5 || rollHistory[i].d[t] == 6) ? imgD : imgS;
                        rollMsg += imgMacro(imgSource, allDice[rollHistory[i].d[t]].clr);
                    }
                    else if (rollHistory[i].r[t] === true) {
                        // subtract the original dice's value from the history
                        rollHistory[i].s -= allDice[rollHistory[i].d[t]].val[rollHistory[i].v[t]];
                        rollHistory[i].c -= allDice[rollHistory[i].d[t]].crit[rollHistory[i].v[t]];
                        // roll a new face
                        var newRoll = randomInteger(6) - 1;
                        rollMsg += "<div style='display:inline-block;'>(" + imgMacro(allDice[rollHistory[i].d[t]].roll[newRoll], allDice[rollHistory[i].d[t]].clr) +
                            rerollImgMacro(allDice[rollHistory[i].d[t]].roll[rollHistory[i].v[t]], allDice[rollHistory[i].d[t]].clr) + ")</div>";
                        // update the roll history with the new value
                        rollHistory[i].v[t] = newRoll;
                        rollHistory[i].s += allDice[rollHistory[i].d[t]].val[rollHistory[i].v[t]];
                        rollHistory[i].c += allDice[rollHistory[i].d[t]].crit[rollHistory[i].v[t]];
                    }
                    else {
                        rollMsg += imgMacro(allDice[rollHistory[i].d[t]].roll[rollHistory[i].v[t]], allDice[rollHistory[i].d[t]].clr);
                    }
                }
                rollMsg += "</span>";
                values.rolls['r' + i] = rollMsg;
            }
            var msg = makeTemplate(values, false);
            sendChat(msgFrom, "/direct " + msg);
            state.FarhomeDice.lastRolls[character.id] = [];
        },

        handleTemplateRoll = function (msgFrom, msgContent) {
            // parsing message
            var idx = 0;
            var ops = [];
            var hasRoll = false;
            while (idx < msgContent.length) {
                if (msgContent[idx] == '`') {
                    for (var i = idx + 1; i < msgContent.length; i++) {
                        if (msgContent[i] == '`') {
                            ops.push(msgContent.substring(idx + 1, i));
                            idx = i;
                            break;
                        }
                    }
                }
                idx++;
            }
            //process template values
            var handleRoll = function (params) {
                if (params[0] == "skill") {
                    return skillRoll(params.slice(1, params.length));
                } else if (params[0] == "save") {
                    return saveRoll(params.slice(1, params.length));
                } else if (params[0] == "roll") {
                    return customRoll(params.slice(1, params.length));
                } else if (params[0] == "attack") {
                    return attack(params.slice(1, params.length));
                } else if (params[0] == "defend") {
                    return defend(params.slice(1, params.length));
                } else if (params[0] == "wound") {
                    return wound(params.slice(1, params.length));
                }
            };
            var templateObj = { rolls: {}, text: {} };
            for (var i = 0; i < ops.length; i++) {
                var opStr = ops[i].split('|');
                var params = [];
                if (opStr[0].includes('.')) {
                    var cmd = opStr[0].split('.');
                    if (cmd[0] === "roll") {
                        hasRoll = true;
                        params = opStr[1].split(' ');
                        templateObj.rolls[cmd[1]] = handleRoll(params);
                    } else if (cmd[0] === "text") {
                        templateObj.text[cmd[1]] = opStr[1];
                    }
                } else {
                    templateObj[opStr[0]] = opStr[1];
                }
            }

            var msg = makeTemplate(templateObj, hasRoll);
            sendChat(msgFrom, "/direct " + msg);
        },

        makeTemplate = function (values, rrButton = true) {
            var suc = 0
            var crit = 0;
            for (var i = 0; i < rollHistory.length; i++) {
                suc += rollHistory[i].s;
                crit += rollHistory[i].c;
            }
            var msg = '' +
                '<rolltemplate class="sheet-rolltemplate-CustomRoll">' +
                '<div style="background-color: #ffffff; border: 1px solid; padding: 2px; width: 218px;">';
            if (values.name) {
                msg += '<div style="padding: 2px"><h1 style="color: rgb(126, 45, 64); font-size: 1.2em; font-variant: small-caps; line-height: 20px;">' + values.name + '</h1></div>';
            }
            if (values.description) {
                msg += '<div style="padding: 2px"><span style="color: #000; font-size: 0.85em; font-style: italic;">' + values.description + '</span></div>';
            }
            msg += '<div style="line-height: 20px;border-bottom: 2px solid transparent; border-left: 200px solid rgb(126, 45, 64); border-top: 2px solid transparent;"><div class="arrow-right"></div></div>';

            var keys = Object.keys(values.rolls);
            for (var i = 0; i < keys.length; i++) {
                msg += '<div style="font-size: 0.9em"><span>' + keys[i] + ': </span>' + values.rolls[keys[i]] + '</div>';
            }

            if (keys.length > 0) {
                msg += '<div style="font-size: 1.1em; text-align:center; font-weight:bold">' +
                    '<span style="color: ' + (suc > 0 ? 'green' : (suc === 0 ? 'black' : 'red')) + '">' + suc + '</span>' +
                    '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span style="color: ' + (crit > 0 ? 'green' : (crit === 0 ? 'black' : 'red')) + '">' + crit + '</span></div>';
            }

            msg += '<div style="line-height: 20px;border-bottom: 2px solid transparent; border-left: 200px solid rgb(126, 45, 64); border-top: 2px solid transparent;"><div class="arrow-right"></div></div>';

            keys = Object.keys(values.text);
            for (var i = 0; i < keys.length; i++) {
                msg += '<div style="font-size: 0.9em"><span style="font-weight:bold">' + keys[i] + ': </span>' + values.text[keys[i]] + '</div>';
            }

            if (rrButton === true) {
                msg += '<div style="font-size: 0.9em; display: inline-block"><a href="!rr" style="background-color: transparent; display: inline-block; color: black; border: 0.5px solid">Reroll Selected</a></div>';
            }
            if (values.mana) {
                var mana = getAttr("mana", 0).get("current");
                msg += '<div style="font-size: 0.9em; display: inline-block"><a href="!mana ' + values.mana + '" style="background-color: transparent; display: inline-block; color: black; border: 0.5px solid">Cast (' + mana + '/' + values.mana + ')</a></div>';
            }
            msg += '</div>' +
                '</rolltemplate>';

            state.FarhomeDice.lastRolls[character.id] = rollHistory;
            return msg;
        },

        roll = function (diceVals, modObj) {
            var msg = "";
            var successes = modObj.success, crits = modObj.crit;
            // we need to save the roll history to allow rerolls to happen
            // d -> dice index to use, v -> which side the die rolled, r -> used for rerolls, s = total succeses, c = total crits
            var rollResult = { d: [], v: [], r: [], s: 0, c: 0 };
            var diceCount = 0;

            if (modObj.poison !== undefined) {
                diceVals[3] += modObj.poison;
            }

            for (var i = 0; i < diceVals.length; i++) {
                if (diceVals[i] + modObj.bonus[i] > 0) {
                    msg += "<span>";
                    for (var t = 0; t < diceVals[i] + modObj.bonus[i]; t++) {
                        rollResult.d.push(i);
                        rollResult.r.push(false);
                        var rollVal = randomInteger(6) - 1;
                        if (modObj.hex > 0 && allDice[i].crit[rollVal] == 1) {
                            rollResult.v.push(-1);
                            var imgSource = (i == 5 || i == 6) ? imgD : imgS;
                            msg += "<div style='display:inline-block'>(" + imgMacro(imgSource, allDice[i].clr) +
                                rerollImgMacro(allDice[i].roll[rollVal], allDice[i].clr) + ")</div>";
                            modObj.hex--;
                            successes += 1;
                        } else {
                            rollResult.v.push(rollVal);
                            successes += allDice[i].val[rollVal];
                            crits += allDice[i].crit[rollVal];
                            msg += "<a href='!srr " + rollHistory.length + " " + diceCount + "' style='" + templateBtn + "'>" +
                                imgMacro(allDice[i].roll[rollVal], allDice[i].clr) +
                                "</a>";
                        }
                        diceCount++;
                    }
                    msg += "</span>";
                }
            }
            rollResult.s = successes;
            rollResult.c = crits;
            rollHistory.push(rollResult);
            return msg;
        },

        spell = function (msgFrom, params) {
            var values = { rolls: {}, text: {} };
            params[0] = params[0].toLowerCase();
            if (spellInfo[params[0]] === undefined) {
                values.name = params[0];
                values.text = { effect: "Spell not listed. Either it's not coded or spelled incorrectly." };

                var msg = makeTemplate(values);
                sendChat(msgFrom, "/direct " + msg);
                return;
            }

            var info = spellInfo[params[0]];
            var modObj = getMods(params[params.length - 1]);
            var dmg = [info.dmg[0], info.dmg[1]];
            var level = parseInt(params[1]);
            var levelDiff = level - info.level;
            for (var i = 0; i < 7; i++) {
                modObj.bonus[i] += info.lroll[i] * levelDiff;
            }
            dmg[0] += info.lroll[7] * levelDiff + modObj.bonus[7];
            dmg[1] += info.lroll[8] * levelDiff + modObj.bonus[8];
            modObj.bonus[7] = 0;
            modObj.bonus[8] = 0;

            if (level < info.level) {
                values.name = params[0];
                values.text = { effect: "Did you enter the right level? Spell needs a minimum of " + info.level + ", entered " + level };

                var msg = makeTemplate(values);
                sendChat(msgFrom, "/direct " + msg);
                return;
            }

            //rebuild bonus dice to pass into skill roll
            var prefix = ['s', 'e', 'n', 'b', 't', 'sd', 'd', 'gw', 'w', 'h'];
            var bonus = "b" + (modObj.success >= 0 ? "sc" + modObj.success : "f" + -modObj.success) + '-' +
                (modObj.crit >= 0 ? "cs" + modObj.crit : "cf" + -modObj.crit);
            for (var i = 0; i < modObj.bonus.length; i++) {
                if (modObj.bonus[i] > 0) {
                    bonus += "-" + prefix[i] + modObj.bonus[i];
                }
            }

            values.name = params[0];
            values.description = "Lv" + level + ", " + info.ap + ", Range " + info.range + ", " + info.duration;
            if (info.dmgType !== undefined) {
                values.description += ', ' + info.dmgType;
            }
            values.text.spells = "";
            for (var i = 0; i < info.txt.length; i++) {
                values.text.spells += info.txt[i] + (i !== info.txt.length - 1 ? "<br/><br/>" : "");
            }
            var manaPerLevel = [0, 1, 2, 3, 4, 6, 8, 10, 13, 16, 20];
            level = Math.min(10, Math.max(0, level));
            values.mana = manaPerLevel[level];

            values.rolls.Spell = skillRoll([getAttr(info.stat, "0").get("current"), getAttr(info.prof, "0").get("current"), bonus]);
            if (dmg[0] > 0 || dmg[1] > 0) {
                values.rolls.Dmg = wound([dmg[0].toString(), dmg[1].toString()]);
            }

            var msg = makeTemplate(values);
            sendChat(msgFrom, "/direct " + msg);
        };

    return {
        CommandListener: commandListener
    };

}());

on('ready', function () {
    'use strict';

    FarhomeDice.CommandListener();

    if (state.FarhomeDice === undefined || state.FarhomeDice.version !== "v1.0") {
        state.FarhomeDice = { lastRolls: {}, version: "v1.0" };
    }

    log("Farhome Dice v1.0 loaded");
});